<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bluenet: Adding a new board</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
	DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bluenet
   &#160;<span id="projectnumber">5.4.0</span>
   </div>
   <div id="projectbrief">Bluenet, the firmware for the Crownstone power outlet</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_ADD_BOARD.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Adding a new board </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md286"></a>
Information required</h1>
<p >The pin layout can be found online for e.g. the <a href="https://infocenter.nordicsemi.com/index.jsp?topic=%2Fcom.nordic.infocenter.nrf52832.ps.v1.1%2Fpin.html&amp;cp=4_2_0_3&amp;anchor=pin_assign">nRF52832</a> and the <a href="https://infocenter.nordicsemi.com/index.jsp?topic=%2Fps_nrf52833%2Fpin.html">nRF52833</a>.</p>
<p >The nRF52833 has mappings like:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Pin   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone"><a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> Description   </th><th class="markdownTableHeadNone">Pin nr    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">A8   </td><td class="markdownTableBodyNone">P0.31 (AIN7)   </td><td class="markdownTableBodyNone">V1   </td><td class="markdownTableBodyNone">31    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">A10   </td><td class="markdownTableBodyNone">P0.29 (AIN5)   </td><td class="markdownTableBodyNone">V2   </td><td class="markdownTableBodyNone">29    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">A12   </td><td class="markdownTableBodyNone">P0.02 (AIN0)   </td><td class="markdownTableBodyNone">I1   </td><td class="markdownTableBodyNone">2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">B13   </td><td class="markdownTableBodyNone">P0.03 (AIN1)   </td><td class="markdownTableBodyNone">I2   </td><td class="markdownTableBodyNone">3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AD8   </td><td class="markdownTableBodyNone">P0.13   </td><td class="markdownTableBodyNone">reset (relay)   </td><td class="markdownTableBodyNone">13    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AD10   </td><td class="markdownTableBodyNone">P0.15   </td><td class="markdownTableBodyNone">set (relay)   </td><td class="markdownTableBodyNone">15    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">J1   </td><td class="markdownTableBodyNone">P0.04 (AIN2)   </td><td class="markdownTableBodyNone">NTC &lt;needs patch&gt;   </td><td class="markdownTableBodyNone">4    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">A14   </td><td class="markdownTableBodyNone">P0.19   </td><td class="markdownTableBodyNone">floating   </td><td class="markdownTableBodyNone">19    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">N1   </td><td class="markdownTableBodyNone">P0.08   </td><td class="markdownTableBodyNone"><a class="el" href="classPWM.html" title="Pulse Wide Modulation class.">PWM</a>   </td><td class="markdownTableBodyNone">8    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">K2   </td><td class="markdownTableBodyNone">P0.05 (AIN3)   </td><td class="markdownTableBodyNone">Reference voltage   </td><td class="markdownTableBodyNone">5    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AD18   </td><td class="markdownTableBodyNone">P0.22   </td><td class="markdownTableBodyNone">RX   </td><td class="markdownTableBodyNone">22    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AD16   </td><td class="markdownTableBodyNone">P0.20   </td><td class="markdownTableBodyNone">TX   </td><td class="markdownTableBodyNone">20    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AD20   </td><td class="markdownTableBodyNone">P0.24   </td><td class="markdownTableBodyNone">GPIO1   </td><td class="markdownTableBodyNone">24    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AD22   </td><td class="markdownTableBodyNone">P1.00   </td><td class="markdownTableBodyNone">GPIO2   </td><td class="markdownTableBodyNone">32    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">W24   </td><td class="markdownTableBodyNone">P1.02   </td><td class="markdownTableBodyNone">GPIO3   </td><td class="markdownTableBodyNone">34    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U24   </td><td class="markdownTableBodyNone">P1.04   </td><td class="markdownTableBodyNone">GPIO4   </td><td class="markdownTableBodyNone">36    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AC24   </td><td class="markdownTableBodyNone">SWDIO   </td><td class="markdownTableBodyNone">SWDIO   </td><td class="markdownTableBodyNone">X    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AA24   </td><td class="markdownTableBodyNone">SWCLK   </td><td class="markdownTableBodyNone">SWDCLK   </td><td class="markdownTableBodyNone">X   </td></tr>
</table>
<p >Here the pin and name can be found at Nordic. To understand the functionality of each pin, you will have to look at the PCB itself, read the schematics files (if you have them), or contact <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>. There can also be additional pins, e.g. to enable the dimming functionality, or there might be some LEDs.</p>
<p >The mapping for pins at port 1 is <code>(((port) &lt;&lt; 5) | ((pin) &amp; 0x1F))</code>. For example, pin P1.00 will map to 32.</p>
<p >For example on the ACR01B11A board there is an <a href="http://www.ti.com/lit/ds/symlink/ucc5310.pdf">UCC5310</a> gate driver. In 10.4 Device Functional Modes there is a table. Here the first two columns are reverted given that we can only control IN-.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">IN-   </th><th class="markdownTableHeadNone">IN+   </th><th class="markdownTableHeadNone">OUT    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">high   </td><td class="markdownTableBodyNone">X   </td><td class="markdownTableBodyNone">low    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">low   </td><td class="markdownTableBodyNone">high   </td><td class="markdownTableBodyNone">high   </td></tr>
</table>
<p >Hence, it is inverting (OUT is almost directly coupled to the gates of the IGBTs).</p>
<h1><a class="anchor" id="autotoc_md287"></a>
Files to be adjusted</h1>
<p >in order to add a new board you need to alter multiple files. These are:</p><ul>
<li><a href="../source/include/cfg/cs_Boards.h">cs_Boards.h</a></li>
<li><a href="../source/src/cfg/cs_Boards.c">cs_Boards.c</a></li>
<li><a href="../source/include/cfg/cs_HardwareVersions.h">cs_HardwareVersions.h</a></li>
<li><a href="../source/conf/cmake/CMakeBuild.config.default">CMakeBuild.config.default</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md288"></a>
cs_Boards.h</h2>
<p >Here you just need to add the new board to the list of defined boards and give tie the new board to a decimal value that can be described by a 32bit variable. The name you define here will be used in the other files to refer to your new board.</p>
<h2><a class="anchor" id="autotoc_md289"></a>
cs_Boards.c</h2>
<p >Here you will need to define the pinout of your new board. You can copy the template at the top of the file and fill in the appropriate pin numbers and options. Change the function name to reflect your new board, i.e. <code>void asYOURNEWBOARD(...</code></p>
<p >After adding your new board as a function, make sure it can be called by adding it to the switch case statement at the bottom of the cs_Boards.c file. The case your will expect for your new board is the name you supplied in cs.Boards.h.</p>
<p >If your new board has a pinout that is the same as a previous board, you don't need to add a new void function for it. You will need to refer to the correct option in the switch case option for you own board name however.</p>
<h2><a class="anchor" id="autotoc_md290"></a>
cs_HardwareVersion.h</h2>
<p >Add your new board version to this file by following the guide and examples.</p>
<h2><a class="anchor" id="autotoc_md291"></a>
CMakeBuild.config.default</h2>
<p >Add you new board in the list of commented boards. This will ensure that someone will be able to find and implement your new board easily in the future. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
