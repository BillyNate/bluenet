<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bluenet: Logging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
	DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bluenet
   &#160;<span id="projectnumber">5.4.0</span>
   </div>
   <div id="projectbrief">Bluenet, the firmware for the Crownstone power outlet</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_LOGGING.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Logging </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >There are multiple manners with which <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> firmware supports logging:</p>
<ol type="1">
<li>UART binary logging. This is the default, and enables event data to be sent to the computer, and commands to be received from the computer.</li>
<li>UART plain text logging.</li>
<li>UART plain text logging with the NRF backend. Useful to get SDK logs, and crash reasons.</li>
<li>RTT logging, this requires a JLink and can be used next to UART logging 1 and 2. Useful to debug the UART, or to get mesh SDK logs.</li>
</ol>
<p >When using options other than binary logging, you might run into problems with the size of the firmware binary. In that case, you will have to decrease the log verbosity:</p><ul>
<li>Bluenet: <code>SERIAL_VERBOSITY</code> in your configuration settings file <code>CMakeBuild.config</code>.</li>
<li>SDK: variables like <code>NRF_LOG_DEFAULT_LEVEL</code> in <code>app_config.h</code>.</li>
<li><a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a>: variables like in <code>LOG_LEVEL_DEFAULT</code> in <code><a class="el" href="nrf__mesh__config__app_8h_source.html">nrf_mesh_config_app.h</a></code>, and the settings passed to <code>__LOG_INIT()</code> in <code>cs_MeshCore.cpp</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md118"></a>
Uart config</h1>
<p >The firmware will send logs using a UART (a universal asynchronous receiver-transmitter). The UART on the computer's side can be specified in the target configuration settings:</p>
<div class="fragment"><div class="line">UART_DEVICE=/dev/ttyUSB0</div>
</div><!-- fragment --><p >To prevent a complete rebuild for just changing the UART device, define it in the <a href="INSTALL.md#overwrites-and-runtime-configs">runtime config</a>.</p>
<p >The UART chip is made available through a character device file like <code>/dev/ttyUSB0</code> by the driver on your operating system. Make sure you have set the right operating system permissions. For example, add your user to the dialout group, or use sudo.</p>
<p >Whether the firmware prints the logs in plain text or in binary mode is a configuration setting as well: </p><div class="fragment"><div class="line">CS_UART_BINARY_PROTOCOL_ENABLED=1</div>
</div><!-- fragment --><p >When using the NRF backend, you will have to manually configure the correct UART TX pin to use, at compile time: </p><div class="fragment"><div class="line">CS_SERIAL_NRF_LOG_ENABLED=1</div>
<div class="line">CS_SERIAL_NRF_LOG_PIN_TX=6</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md119"></a>
Plain text logs</h1>
<p >If the you use plain text UART, then use can use a program like minicom (<code>sudo apt install minicom</code>): </p><pre class="fragment">make uart_client
</pre> <h1><a class="anchor" id="autotoc_md120"></a>
Binary logs</h1>
<p >Binary logging strips log format strings from the firmware and puts them in a separate file. The binary log client uses this file to add the strings again on the client side. It's important to realise that the file with log strings has to be generated from the exact same source code that runs on your crownstone.</p>
<p >To generate the file with log strings, first compile the code, and then run <code>extract_logs</code>: </p><pre class="fragment">cd build/default
make
make extract_logs
</pre><p> The generated file with log strings will end up in the <code>build/default</code> dir.</p>
<p >To read the logs you need to install <a href="https://github.com/crownstone/bluenet-lib-logs/">bluenet-lib-logs</a>. </p><pre class="fragment">python3 -m pip install bluenet_logs
</pre><p> You can run the client through: </p><pre class="fragment">make uart_binary_client
</pre><p> The above command calls <code>scripts/log-client.py</code> with <code>UART_DEVICE</code> from your config as device and the generated file as log strings file.</p>
<h1><a class="anchor" id="autotoc_md121"></a>
RTT logs</h1>
<p >For RTT logs, you need to run a GDB server: </p><pre class="fragment">cd build/default
make debug_server
</pre><p> And the client in a separate terminal: </p><pre class="fragment">make rtt_client
</pre><p> This will use the <code>RTT_PORT</code> from your config, or the default if none is defined. To prevent a complete rebuild for just changing the RTT port, define it in the <a href="INSTALL.md#overwrites-and-runtime-configs">runtime config</a>.</p>
<h1><a class="anchor" id="autotoc_md122"></a>
Details</h1>
<p >There are quite some details involved with respect to the UART, logging, release firmware. Here we try to clear up a few potentional misconceptions.</p>
<ul>
<li>If you attach a <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> and you do not know which firmware is on it, you will have a hard time getting the debug information out. Hence, it is a good habit to do regular public commits. For each public commit it is possible to check out that particular commit and then run the <code>log-client.py</code> script to be able to get the debug logs.</li>
<li>If you attach a <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> and you do actually know that it is one with a version on it that is committed, you have to find out a way to get this information out. There is no UART command yet to read out the firmware version (see <a class="el" href="md_docs_protocol_UART_PROTOCOL.html">UART_PROTOCOL</a> and <a href="https://github.com/crownstone/crownstone-lib-python-uart/blob/master/DOCUMENTATION.md">lib doc</a>). If the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> is operational and you have the encryption keys you can get the firmware version over Bluetooth.</li>
<li>If you attach a <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> for which logging is enabled, there's some output in plain text (so you know that the UART is operational). There is no UART command to enable logging. In none of our releases is logging enabled [1]. Note that apart from logging settings, the UART support might be compiled in, but not enabled [2].</li>
</ul>
<p >For logging there are several levels of verbosity, for example:</p>
<div class="fragment"><div class="line">SERIAL_VERBOSITY=SERIAL_INFO</div>
</div><!-- fragment --><p >In releases, the following mode is used:</p>
<div class="fragment"><div class="line">SERIAL_VERBOSITY=SERIAL_BYTE_PROTOCOL_ONLY</div>
</div><!-- fragment --><p >This means no logging through for example <code>LOGi("hi")</code> or <code>LOGw("hi")</code> calls. All these calls are not even compiled into the firmware. There is only support for the commands.</p>
<p >[1]. On the moment there is no command to enable logging. In the future there might be, but for now logging is completely disabled in releases.</p>
<p >[2]. This concerns release firmware. The <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> USB dongle has both TX and RX enabled. The other Crownstones have only RX enabled in setup mode (it can only receive commands, not respond) and have both TX and RX disabled in normal mode.</p>
<p >Note that binary logging is <b>required</b> if you want to run everything on the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> (or no logging at all of course). You can only run plain text logging if you disable parts of its functionality. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
