<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bluenet: Crownstone Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bluenet
   &#160;<span id="projectnumber">5.4.0</span>
   </div>
   <div id="projectbrief">Bluenet, the firmware for the Crownstone power outlet</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classCrownstone-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Crownstone Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> encapsulates all functionality, stack, services, and configuration.  
 <a href="classCrownstone.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="cs__Crownstone_8h_source.html">cs_Crownstone.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Crownstone:</div>
<div class="dyncontent">
<div class="center"><img src="classCrownstone__inherit__graph.png" border="0" usemap="#Crownstone_inherit__map" alt="Inheritance graph"/></div>
<map name="Crownstone_inherit__map" id="Crownstone_inherit__map">
<area shape="rect" title="Crownstone encapsulates all functionality, stack, services, and configuration." alt="" coords="11,80,103,107"/>
<area shape="rect" href="classEventListener.html" title="Event listener." alt="" coords="5,5,108,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for Crownstone:</div>
<div class="dyncontent">
<div class="center"><img src="classCrownstone__coll__graph.png" border="0" usemap="#Crownstone_coll__map" alt="Collaboration graph"/></div>
<map name="Crownstone_coll__map" id="Crownstone_coll__map">
<area shape="rect" title="Crownstone encapsulates all functionality, stack, services, and configuration." alt="" coords="11,80,103,107"/>
<area shape="rect" href="classEventListener.html" title="Event listener." alt="" coords="5,5,108,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a68f381ec23cdf2e8732af9e28fc9ba47"><td class="memItemLeft" align="right" valign="top"><a id="a68f381ec23cdf2e8732af9e28fc9ba47"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><b>ServiceEvent</b> { <br />
&#160;&#160;<b>CREATE_DEVICE_INFO_SERVICE</b>, 
<b>CREATE_SETUP_SERVICE</b>, 
<b>CREATE_CROWNSTONE_SERVICE</b>, 
<b>REMOVE_DEVICE_INFO_SERVICE</b>, 
<br />
&#160;&#160;<b>REMOVE_SETUP_SERVICE</b>, 
<b>REMOVE_CROWNSTONE_SERVICE</b>
<br />
 }</td></tr>
<tr class="separator:a68f381ec23cdf2e8732af9e28fc9ba47"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8f48e0a6a9269408a121c0c29a4670a6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrownstone.html#a8f48e0a6a9269408a121c0c29a4670a6">Crownstone</a> (<a class="el" href="structboards__config__t.html">boards_config_t</a> &amp;board)</td></tr>
<tr class="memdesc:a8f48e0a6a9269408a121c0c29a4670a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> class and internal references.  <a href="classCrownstone.html#a8f48e0a6a9269408a121c0c29a4670a6">More...</a><br /></td></tr>
<tr class="separator:a8f48e0a6a9269408a121c0c29a4670a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54b4e6645a3d3995e65bd3268ffcef23"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrownstone.html#a54b4e6645a3d3995e65bd3268ffcef23">init</a> (uint16_t step)</td></tr>
<tr class="memdesc:a54b4e6645a3d3995e65bd3268ffcef23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the crownstone:  <a href="classCrownstone.html#a54b4e6645a3d3995e65bd3268ffcef23">More...</a><br /></td></tr>
<tr class="separator:a54b4e6645a3d3995e65bd3268ffcef23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac012844b9a0242710badb3f19713e8af"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrownstone.html#ac012844b9a0242710badb3f19713e8af">startUp</a> ()</td></tr>
<tr class="memdesc:ac012844b9a0242710badb3f19713e8af"><td class="mdescLeft">&#160;</td><td class="mdescRight">startup the crownstone:  <a href="classCrownstone.html#ac012844b9a0242710badb3f19713e8af">More...</a><br /></td></tr>
<tr class="separator:ac012844b9a0242710badb3f19713e8af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a315537a2d45fb2204f75b65afa5fbcc9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrownstone.html#a315537a2d45fb2204f75b65afa5fbcc9">run</a> ()</td></tr>
<tr class="memdesc:a315537a2d45fb2204f75b65afa5fbcc9"><td class="mdescLeft">&#160;</td><td class="mdescRight">run main  <a href="classCrownstone.html#a315537a2d45fb2204f75b65afa5fbcc9">More...</a><br /></td></tr>
<tr class="separator:a315537a2d45fb2204f75b65afa5fbcc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ff233ea165f2bb9f95c99502d383cab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrownstone.html#a4ff233ea165f2bb9f95c99502d383cab">handleEvent</a> (<a class="el" href="classevent__t.html">event_t</a> &amp;event)</td></tr>
<tr class="memdesc:a4ff233ea165f2bb9f95c99502d383cab"><td class="mdescLeft">&#160;</td><td class="mdescRight">handle (crownstone) events  <a href="classCrownstone.html#a4ff233ea165f2bb9f95c99502d383cab">More...</a><br /></td></tr>
<tr class="separator:a4ff233ea165f2bb9f95c99502d383cab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a25421d10c36e3f9f7098bb54d0cd1f64"><td class="memItemLeft" align="right" valign="top"><a id="a25421d10c36e3f9f7098bb54d0cd1f64"></a>
static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrownstone.html#a25421d10c36e3f9f7098bb54d0cd1f64">updateHeapStats</a> ()</td></tr>
<tr class="memdesc:a25421d10c36e3f9f7098bb54d0cd1f64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the heap statistics. <br /></td></tr>
<tr class="separator:a25421d10c36e3f9f7098bb54d0cd1f64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64c3625abb0998d8a9ba59476b1e18e3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrownstone.html#a64c3625abb0998d8a9ba59476b1e18e3">updateMinStackEnd</a> ()</td></tr>
<tr class="memdesc:a64c3625abb0998d8a9ba59476b1e18e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the minimal stack end location.  <a href="classCrownstone.html#a64c3625abb0998d8a9ba59476b1e18e3">More...</a><br /></td></tr>
<tr class="separator:a64c3625abb0998d8a9ba59476b1e18e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79a618a1b4e966469001b0d540ea7815"><td class="memItemLeft" align="right" valign="top"><a id="a79a618a1b4e966469001b0d540ea7815"></a>
static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrownstone.html#a79a618a1b4e966469001b0d540ea7815">printLoadStats</a> ()</td></tr>
<tr class="memdesc:a79a618a1b4e966469001b0d540ea7815"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print load stats: RAM usage, app scheduler usage, etc. <br /></td></tr>
<tr class="separator:a79a618a1b4e966469001b0d540ea7815"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9fd4dd6a0ae70614233a4bcb8817d42"><td class="memItemLeft" align="right" valign="top"><a id="aa9fd4dd6a0ae70614233a4bcb8817d42"></a>
static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrownstone.html#aa9fd4dd6a0ae70614233a4bcb8817d42">staticTick</a> (<a class="el" href="classCrownstone.html">Crownstone</a> *ptr)</td></tr>
<tr class="memdesc:aa9fd4dd6a0ae70614233a4bcb8817d42"><td class="mdescLeft">&#160;</td><td class="mdescRight">tick function called by app timer <br /></td></tr>
<tr class="separator:aa9fd4dd6a0ae70614233a4bcb8817d42"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> encapsulates all functionality, stack, services, and configuration. </p>
<hr  />
<p> General includes</p>
<hr  />
<hr  />
<p> Main functionality</p>
<hr  />
 </div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a8f48e0a6a9269408a121c0c29a4670a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f48e0a6a9269408a121c0c29a4670a6">&#9670;&nbsp;</a></span>Crownstone()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Crownstone::Crownstone </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structboards__config__t.html">boards_config_t</a> &amp;&#160;</td>
          <td class="paramname"><em>board</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> class and internal references. </p>
<p>Create buffers, timers, storage, state, etc. We are running on an embedded device. Only allocate something in a constructor. For dynamic information use the stack. Do not allocate/deallocate anything during runtime. It is too risky. It might not be freed and memory might overflow. This type of hardware should run months without interruption.</p>
<p>There is a function IS_CROWNSTONE. What this actually is contrasted with are other BLE type devices, in particular the Guidestone. The latter devices do not have the ability to switch, dim, or measure power consumption.</p>
<p>The order with which items are created.</p>
<ul>
<li>buffers</li>
<li>event distpatcher</li>
<li>BLE stack</li>
<li>timer</li>
<li>persistent storage</li>
<li>state</li>
<li>command handler</li>
<li>factory reset</li>
<li>scanner</li>
<li>tracker</li>
<li>mesh</li>
<li>switch</li>
<li>temperature guard</li>
<li>power sampling</li>
</ul>
<p>The initialization is done in separate function. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a4ff233ea165f2bb9f95c99502d383cab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ff233ea165f2bb9f95c99502d383cab">&#9670;&nbsp;</a></span>handleEvent()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Crownstone::handleEvent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classevent__t.html">event_t</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>handle (crownstone) events </p>
<p>Handle events that can come from other parts of the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> firmware and even originate from outside of the firmware via the BLE interface (an application, or the mesh). </p>

<p>Implements <a class="el" href="classEventListener.html#ab746290fb9240d83d231cd390c3cafad">EventListener</a>.</p>

</div>
</div>
<a id="a54b4e6645a3d3995e65bd3268ffcef23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54b4e6645a3d3995e65bd3268ffcef23">&#9670;&nbsp;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Crownstone::init </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>step</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the crownstone: </p>
<ol type="1">
<li>start UART</li>
<li>configure (drivers, stack, advertisement)</li>
<li>check operation mode 3a. for setup mode, create setup services 3b. for normal operation mode, create crownstone services and prepare <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> for operation</li>
<li>initialize services</li>
</ol>
<p>Since some classes initialize asynchronous, this function is called multiple times to continue the process. When the class is initialized, the init done event will continue the initialization of other classes. Initialize <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> firmware. First drivers are initialized (log modules, storage modules, <a class="el" href="classADC.html" title="Analog-Digital conversion.">ADC</a> conversion, timers). Then everything is configured independent of the mode (everything that is common to whatever mode the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> runs on). A callback to the local staticTick function for a timer is set up. Then the mode of operation is switched and the BLE services are initialized. </p>

</div>
</div>
<a id="a315537a2d45fb2204f75b65afa5fbcc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a315537a2d45fb2204f75b65afa5fbcc9">&#9670;&nbsp;</a></span>run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Crownstone::run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>run main </p>
<ol type="1">
<li>execute app scheduler</li>
<li>wait for ble events An infinite loop in which the application ceases control to the SoftDevice at regular times. It runs the scheduler, waits for events, and handles them. Also the printed statements in the log module are flushed. </li>
</ol>

</div>
</div>
<a id="ac012844b9a0242710badb3f19713e8af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac012844b9a0242710badb3f19713e8af">&#9670;&nbsp;</a></span>startUp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Crownstone::startUp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>startup the crownstone: </p>
<ol type="1">
<li>start advertising</li>
<li>start processing (mesh, scanner, tracker, tempGuard, etc) After allocation of all modules, after initialization of each module, and after configuration of each module, we are ready to "start". This means:</li>
</ol>
<ul>
<li>advertise</li>
<li>turn on/off switch at boot (depending on default)</li>
<li>watch temperature excess</li>
<li>power sampling</li>
<li>schedule tasks </li>
</ul>

</div>
</div>
<a id="a64c3625abb0998d8a9ba59476b1e18e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64c3625abb0998d8a9ba59476b1e18e3">&#9670;&nbsp;</a></span>updateMinStackEnd()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void Crownstone::updateMinStackEnd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update the minimal stack end location. </p>
<p>Should be called regularly from high level interrupt. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>source/include/<a class="el" href="cs__Crownstone_8h_source.html">cs_Crownstone.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
