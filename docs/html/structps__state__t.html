<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bluenet: ps_state_t Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bluenet
   &#160;<span id="projectnumber">0.3.0</span>
   </div>
   <div id="projectbrief">Bluenet, the firmware for the Crownstone power outlet</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structps__state__t-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ps_state_t Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The <a class="el" href="structps__state__t.html" title="The ps_state_t struct is used to store elements that are changed relatively frequently. ">ps_state_t</a> struct is used to store elements that are changed relatively frequently.  
 <a href="structps__state__t.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="cs__State_8h_source.html">cs_State.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for ps_state_t:</div>
<div class="dyncontent">
<div class="center"><img src="structps__state__t__inherit__graph.png" border="0" usemap="#ps__state__t_inherit__map" alt="Inheritance graph"/></div>
<map name="ps__state__t_inherit__map" id="ps__state__t_inherit__map">
<area shape="rect" id="node2" href="structps__storage__base__t.html" title="enable additional debug output " alt="" coords="5,5,137,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for ps_state_t:</div>
<div class="dyncontent">
<div class="center"><img src="structps__state__t__coll__graph.png" border="0" usemap="#ps__state__t_coll__map" alt="Collaboration graph"/></div>
<map name="ps__state__t_coll__map" id="ps__state__t_coll__map">
<area shape="rect" id="node2" href="structps__storage__base__t.html" title="enable additional debug output " alt="" coords="5,5,137,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a431bee2a50c2f17effe44d619cdf9490"><td class="memItemLeft" align="right" valign="top"><a id="a431bee2a50c2f17effe44d619cdf9490"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>resetCounter</b> [RESET_COUNTER_REDUNDANCY *ELEM_SIZE(reset_counter_t, small_seq_number_t)]</td></tr>
<tr class="separator:a431bee2a50c2f17effe44d619cdf9490"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacccb53c382aa8a5b82f2dcee43fb168"><td class="memItemLeft" align="right" valign="top"><a id="aacccb53c382aa8a5b82f2dcee43fb168"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>switchState</b> [SWITCH_STATE_REDUNDANCY *ELEM_SIZE(switch_state_storage_t, small_seq_number_t)]</td></tr>
<tr class="separator:aacccb53c382aa8a5b82f2dcee43fb168"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a282b1e95dbff5c7f69eb5ce37733488a"><td class="memItemLeft" align="right" valign="top"><a id="a282b1e95dbff5c7f69eb5ce37733488a"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>accumulatedEnergy</b> [ACCUMULATED_ENERGY_REDUNDANCY *ELEM_SIZE(accumulated_energy_t, large_seq_number_t)]</td></tr>
<tr class="separator:a282b1e95dbff5c7f69eb5ce37733488a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The <a class="el" href="structps__state__t.html" title="The ps_state_t struct is used to store elements that are changed relatively frequently. ">ps_state_t</a> struct is used to store elements that are changed relatively frequently. </p>
<p>Each element is stored separately (the struct is not persisted in its entirety because that would lead to unnecessary writes to FLASH). The writes to FLASH are on the level of words (4 bytes). This is a requirement enforced by pstorage and not conforming to it leads to runtime errors.</p>
<p>The nRF52 has 512 kB FLASH at 0x00000000 to 0x00080000 in the memory map. With the bootloader at the end of the FLASH, the last page available for pstorage is from address 0x78000 to 0x79FFF and is used as internal pstorage swap page. If there are two pages reserved for the application data, it is two pages below the pstorage swap page in the memory map (addresses 76000 to 77FFF).</p>
<p>The nRF52 has 10.000 erase/write cycles. The X_REDUNDANCY macros define redundancy in writing to FLASH. Each write a counter is shifted with the size of the field to be stored. This counter is stored with the field and is persisted as well. If not, we would not be able to pick the right persisted value.</p>
<p>A macro such as SWITCH_STATE_REDUNCACY equal to 200 means 2.000.000 erase/write cycles. Assuming a lifetime of 10 years, this amounts to 87.600 hours. Hence, this redundancy allows us to toggle state 20 times per hour and persist that state.</p>
<p>The ACCUMULATED_ENERGY_REDUNDANCY at 200 is 2.000.000 erase/write cycles. There are 5.256.000 minutes in 10 years, hence this amounts to every 2 and a half minute.</p>
<p>TODO: The seq_number_t counter struct is 16-bits, while 8-bits would already be sufficient. TODO: The switch_state_storage_t field is 16-bits, while 8-bits would be sufficient (1 on/off bit, 7 dimming bits). </p>
</div><hr/>The documentation for this struct was generated from the following file:<ul>
<li>include/storage/<a class="el" href="cs__State_8h_source.html">cs_State.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
