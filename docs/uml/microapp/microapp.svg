<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2300px" preserveAspectRatio="none" style="width:944px;height:2300px;" version="1.1" viewBox="0 0 944 2300" width="944px" zoomAndPan="magnify"><defs><filter height="300%" id="f1knmq3qjhzg3w" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="156.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="359.1563"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="198.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="630.0859"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="156.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="943.1484"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="199.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="1170.9453"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="141.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="1485.0078"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="141.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="1740.8047"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="156.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="1996.6016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="52" x2="52" y1="65.2969" y2="2227.2656"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="161" x2="161" y1="65.2969" y2="2227.2656"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="262" x2="262" y1="65.2969" y2="2227.2656"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="501.5" x2="501.5" y1="65.2969" y2="2227.2656"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="682.5" x2="682.5" y1="65.2969" y2="2227.2656"/><rect fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="8" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="15" y="49.9951">Scheduler</text><rect fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="8" y="2226.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="15" y="2246.2607">Scheduler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="106" y="61.9951">Microapp stack</text><path d="M143,13 C143,3 161,3 161,3 C161,3 179,3 179,13 L179,39 C179,49 161,49 161,49 C161,49 143,49 143,39 L143,13 " fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M143,13 C143,23 161,23 161,23 C161,23 179,23 179,13 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="106" y="2239.2607">Microapp stack</text><path d="M143,2252.5625 C143,2242.5625 161,2242.5625 161,2242.5625 C161,2242.5625 179,2242.5625 179,2252.5625 L179,2278.5625 C179,2288.5625 161,2288.5625 161,2288.5625 C161,2288.5625 143,2288.5625 143,2278.5625 L143,2252.5625 " fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M143,2252.5625 C143,2262.5625 161,2262.5625 161,2262.5625 C161,2262.5625 179,2262.5625 179,2252.5625 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="226" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="233" y="49.9951">Bluenet</text><rect fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="226" y="2226.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="233" y="2246.2607">Bluenet</text><rect fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="407.5" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="171" x="414.5" y="49.9951">Bluenet microapp thread</text><rect fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="407.5" y="2226.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="171" x="414.5" y="2246.2607">Bluenet microapp thread</text><rect fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="642.5" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="649.5" y="49.9951">Microapp</text><rect fill="#FEFECE" filter="url(#f1knmq3qjhzg3w)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="642.5" y="2226.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="649.5" y="2246.2607">Microapp</text><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="156.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="359.1563"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="198.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="630.0859"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="156.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="943.1484"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="199.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="1170.9453"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="141.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="1485.0078"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="141.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="1740.8047"/><rect fill="#FFFFFF" filter="url(#f1knmq3qjhzg3w)" height="156.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="156" y="1996.6016"/><path d="M12,80.2969 L12,256.2969 L722,256.2969 L722,90.2969 L712,80.2969 L12,80.2969 " fill="#FBFB77" filter="url(#f1knmq3qjhzg3w)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M712,80.2969 L712,90.2969 L722,90.2969 L712,80.2969 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="212.75" y="97.3638">Aruino program looks like:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="216.75" y="112.4966"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="244.75" y="127.6294">void setup() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="216.75" y="142.7622"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="244.75" y="157.895">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="216.75" y="173.0278"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="244.75" y="188.1606">void loop() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="276.75" y="203.2935">digitalWrite(13, HIGH);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="276.75" y="218.4263">int powerUsage = getPowerUsage();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="276.75" y="233.5591">delay(3);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="244.75" y="248.6919">}</text><rect fill="#EEEEEE" filter="url(#f1knmq3qjhzg3w)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="929" x="3" y="286.3242"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="932" y1="286.3242" y2="286.3242"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="932" y1="289.3242" y2="289.3242"/><rect fill="#EEEEEE" filter="url(#f1knmq3qjhzg3w)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="62" x="436.5" y="275.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="442.5" y="291.8247">Setup</text><polygon fill="#A80036" points="250,326.0234,260,330.0234,250,334.0234,254,330.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="256" y1="330.0234" y2="330.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="59" y="324.9575">tick</text><polygon fill="#A80036" points="490,355.1563,500,359.1563,490,363.1563,494,359.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="496" y1="359.1563" y2="359.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="269" y="354.0903">longjmp(microapp)</text><polygon fill="#A80036" points="671,369.1563,681,373.1563,671,377.1563,675,373.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="677" y1="373.1563" y2="373.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="402.2891" y2="402.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="402.2891" y2="415.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="415.2891" y2="415.2891"/><polygon fill="#A80036" points="694,411.2891,684,415.2891,694,419.2891,690,415.2891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="690" y="397.2231">no message to handle</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="444.4219" y2="444.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="444.4219" y2="457.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="457.4219" y2="457.4219"/><polygon fill="#A80036" points="694,453.4219,684,457.4219,694,461.4219,690,457.4219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="690" y="439.356">setup()</text><polygon fill="#A80036" points="513,482.5547,503,486.5547,513,490.5547,509,486.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="507" x2="682" y1="486.5547" y2="486.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="519" y="481.4888">msg: setup done</text><polygon fill="#A80036" points="273,511.6875,263,515.6875,273,519.6875,269,515.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="267" x2="501" y1="515.6875" y2="515.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="279" y="510.6216">longjmp(bluenet)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="304" y1="544.8203" y2="544.8203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="304" x2="304" y1="544.8203" y2="557.8203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="304" y1="557.8203" y2="557.8203"/><polygon fill="#A80036" points="273,553.8203,263,557.8203,273,561.8203,269,557.8203" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="269" y="539.7544">handle command setup done</text><rect fill="#EEEEEE" filter="url(#f1knmq3qjhzg3w)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="929" x="3" y="586.3867"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="932" y1="586.3867" y2="586.3867"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="932" y1="589.3867" y2="589.3867"/><rect fill="#EEEEEE" filter="url(#f1knmq3qjhzg3w)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="55" x="440" y="575.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="36" x="446" y="591.8872">Loop</text><polygon fill="#A80036" points="490,626.0859,500,630.0859,490,634.0859,494,630.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="496" y1="630.0859" y2="630.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="269" y="625.02">longjmp(microapp)</text><polygon fill="#A80036" points="671,640.0859,681,644.0859,671,648.0859,675,644.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="677" y1="644.0859" y2="644.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="673.2188" y2="673.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="673.2188" y2="686.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="686.2188" y2="686.2188"/><polygon fill="#A80036" points="694,682.2188,684,686.2188,694,690.2188,690,686.2188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="690" y="668.1528">no message to handle</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="715.3516" y2="715.3516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="715.3516" y2="728.3516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="728.3516" y2="728.3516"/><polygon fill="#A80036" points="694,724.3516,684,728.3516,694,732.3516,690,728.3516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="690" y="710.2856">loop()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="757.4844" y2="757.4844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="757.4844" y2="770.4844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="770.4844" y2="770.4844"/><polygon fill="#A80036" points="694,766.4844,684,770.4844,694,774.4844,690,770.4844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="690" y="752.4185">digitalWrite(13, HIGH)</text><polygon fill="#A80036" points="513,795.6172,503,799.6172,513,803.6172,509,799.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="507" x2="682" y1="799.6172" y2="799.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="519" y="794.5513">msg: set pin 13 1</text><polygon fill="#A80036" points="273,824.75,263,828.75,273,832.75,269,828.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="267" x2="501" y1="828.75" y2="828.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="279" y="823.6841">longjmp(bluenet)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="304" y1="857.8828" y2="857.8828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="304" x2="304" y1="857.8828" y2="870.8828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="304" y1="870.8828" y2="870.8828"/><polygon fill="#A80036" points="273,866.8828,263,870.8828,273,874.8828,269,870.8828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="269" y="852.8169">handle command: set pin 13 1</text><rect fill="#EEEEEE" filter="url(#f1knmq3qjhzg3w)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="929" x="3" y="899.4492"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="932" y1="899.4492" y2="899.4492"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="932" y1="902.4492" y2="902.4492"/><rect fill="#EEEEEE" filter="url(#f1knmq3qjhzg3w)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="180" x="377.5" y="888.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161" x="383.5" y="904.9497">Command with return</text><polygon fill="#A80036" points="490,939.1484,500,943.1484,490,947.1484,494,943.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="496" y1="943.1484" y2="943.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="269" y="938.0825">longjmp(microapp)</text><polygon fill="#A80036" points="671,953.1484,681,957.1484,671,961.1484,675,957.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="677" y1="957.1484" y2="957.1484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="986.2813" y2="986.2813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="986.2813" y2="999.2813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="999.2813" y2="999.2813"/><polygon fill="#A80036" points="694,995.2813,684,999.2813,694,1003.2813,690,999.2813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="690" y="981.2153">no message to handle</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="1028.4141" y2="1028.4141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="1028.4141" y2="1041.4141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="1041.4141" y2="1041.4141"/><polygon fill="#A80036" points="694,1037.4141,684,1041.4141,694,1045.4141,690,1041.4141" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="690" y="1023.3481">getPowerUsage()</text><polygon fill="#A80036" points="513,1066.5469,503,1070.5469,513,1074.5469,509,1070.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="507" x2="682" y1="1070.5469" y2="1070.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="519" y="1065.481">msg: get power usage</text><polygon fill="#A80036" points="273,1095.6797,263,1099.6797,273,1103.6797,269,1099.6797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="267" x2="501" y1="1099.6797" y2="1099.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="279" y="1094.6138">longjmp(bluenet)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="304" y1="1128.8125" y2="1128.8125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="304" x2="304" y1="1128.8125" y2="1141.8125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="304" y1="1141.8125" y2="1141.8125"/><polygon fill="#A80036" points="273,1137.8125,263,1141.8125,273,1145.8125,269,1141.8125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="269" y="1123.7466">handle command: get power usage</text><polygon fill="#A80036" points="490,1166.9453,500,1170.9453,490,1174.9453,494,1170.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="496" y1="1170.9453" y2="1170.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="269" y="1165.8794">longjmp(microapp)</text><polygon fill="#A80036" points="671,1196.0781,681,1200.0781,671,1204.0781,675,1200.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="677" y1="1200.0781" y2="1200.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="509" y="1195.0122">msg: result power usage</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="1229.2109" y2="1229.2109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="1229.2109" y2="1242.2109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="1242.2109" y2="1242.2109"/><polygon fill="#A80036" points="694,1238.2109,684,1242.2109,694,1246.2109,690,1242.2109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="690" y="1224.145">handle message: result power usage</text><rect fill="#EEEEEE" filter="url(#f1knmq3qjhzg3w)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="929" x="3" y="1270.7773"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="932" y1="1270.7773" y2="1270.7773"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="932" y1="1273.7773" y2="1273.7773"/><rect fill="#EEEEEE" filter="url(#f1knmq3qjhzg3w)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="60" x="437.5" y="1260.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="443.5" y="1276.2778">Delay</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="1314.4766" y2="1314.4766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="1314.4766" y2="1327.4766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="1327.4766" y2="1327.4766"/><polygon fill="#A80036" points="694,1323.4766,684,1327.4766,694,1331.4766,690,1327.4766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="690" y="1309.4106">delay(3)</text><polygon fill="#A80036" points="513,1337.4766,503,1341.4766,513,1345.4766,509,1341.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="507" x2="682" y1="1341.4766" y2="1341.4766"/><polygon fill="#A80036" points="273,1366.6094,263,1370.6094,273,1374.6094,269,1370.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="267" x2="501" y1="1370.6094" y2="1370.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="279" y="1365.5435">longjmp(bluenet)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="304" y1="1399.7422" y2="1399.7422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="304" x2="304" y1="1399.7422" y2="1412.7422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="304" y1="1412.7422" y2="1412.7422"/><polygon fill="#A80036" points="273,1408.7422,263,1412.7422,273,1416.7422,269,1412.7422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="269" y="1394.6763">no command to handle</text><polygon fill="#A80036" points="63,1422.7422,53,1426.7422,63,1430.7422,59,1426.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="261" y1="1426.7422" y2="1426.7422"/><polygon fill="#A80036" points="250,1451.875,260,1455.875,250,1459.875,254,1455.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="256" y1="1455.875" y2="1455.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="59" y="1450.8091">tick</text><polygon fill="#A80036" points="490,1481.0078,500,1485.0078,490,1489.0078,494,1485.0078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="496" y1="1485.0078" y2="1485.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="269" y="1479.9419">longjmp(microapp)</text><polygon fill="#A80036" points="671,1495.0078,681,1499.0078,671,1503.0078,675,1499.0078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="677" y1="1499.0078" y2="1499.0078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="1528.1406" y2="1528.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="1528.1406" y2="1541.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="1541.1406" y2="1541.1406"/><polygon fill="#A80036" points="694,1537.1406,684,1541.1406,694,1545.1406,690,1541.1406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="690" y="1523.0747">no message to handle</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="1570.2734" y2="1570.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="1570.2734" y2="1583.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="1583.2734" y2="1583.2734"/><polygon fill="#A80036" points="694,1579.2734,684,1583.2734,694,1587.2734,690,1583.2734" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="690" y="1565.2075">wait for 2 more ticks</text><polygon fill="#A80036" points="513,1593.2734,503,1597.2734,513,1601.2734,509,1597.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="507" x2="682" y1="1597.2734" y2="1597.2734"/><polygon fill="#A80036" points="273,1622.4063,263,1626.4063,273,1630.4063,269,1626.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="267" x2="501" y1="1626.4063" y2="1626.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="279" y="1621.3403">longjmp(bluenet)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="304" y1="1655.5391" y2="1655.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="304" x2="304" y1="1655.5391" y2="1668.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="304" y1="1668.5391" y2="1668.5391"/><polygon fill="#A80036" points="273,1664.5391,263,1668.5391,273,1672.5391,269,1668.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="269" y="1650.4731">no command to handle</text><polygon fill="#A80036" points="63,1678.5391,53,1682.5391,63,1686.5391,59,1682.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="261" y1="1682.5391" y2="1682.5391"/><polygon fill="#A80036" points="250,1707.6719,260,1711.6719,250,1715.6719,254,1711.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="256" y1="1711.6719" y2="1711.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="59" y="1706.606">tick</text><polygon fill="#A80036" points="490,1736.8047,500,1740.8047,490,1744.8047,494,1740.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="496" y1="1740.8047" y2="1740.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="269" y="1735.7388">longjmp(microapp)</text><polygon fill="#A80036" points="671,1750.8047,681,1754.8047,671,1758.8047,675,1754.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="677" y1="1754.8047" y2="1754.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="1783.9375" y2="1783.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="1783.9375" y2="1796.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="1796.9375" y2="1796.9375"/><polygon fill="#A80036" points="694,1792.9375,684,1796.9375,694,1800.9375,690,1796.9375" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="690" y="1778.8716">no message to handle</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="1826.0703" y2="1826.0703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="1826.0703" y2="1839.0703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="1839.0703" y2="1839.0703"/><polygon fill="#A80036" points="694,1835.0703,684,1839.0703,694,1843.0703,690,1839.0703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="690" y="1821.0044">wait for 1 more tick</text><polygon fill="#A80036" points="513,1849.0703,503,1853.0703,513,1857.0703,509,1853.0703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="507" x2="682" y1="1853.0703" y2="1853.0703"/><polygon fill="#A80036" points="273,1878.2031,263,1882.2031,273,1886.2031,269,1882.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="267" x2="501" y1="1882.2031" y2="1882.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="279" y="1877.1372">longjmp(bluenet)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="304" y1="1911.3359" y2="1911.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="304" x2="304" y1="1911.3359" y2="1924.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="304" y1="1924.3359" y2="1924.3359"/><polygon fill="#A80036" points="273,1920.3359,263,1924.3359,273,1928.3359,269,1924.3359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="269" y="1906.27">no command to handle</text><polygon fill="#A80036" points="63,1934.3359,53,1938.3359,63,1942.3359,59,1938.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="261" y1="1938.3359" y2="1938.3359"/><polygon fill="#A80036" points="250,1963.4688,260,1967.4688,250,1971.4688,254,1967.4688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="256" y1="1967.4688" y2="1967.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="59" y="1962.4028">tick</text><polygon fill="#A80036" points="490,1992.6016,500,1996.6016,490,2000.6016,494,1996.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="496" y1="1996.6016" y2="1996.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="269" y="1991.5356">longjmp(microapp)</text><polygon fill="#A80036" points="671,2006.6016,681,2010.6016,671,2014.6016,675,2010.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="677" y1="2010.6016" y2="2010.6016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="2039.7344" y2="2039.7344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="2039.7344" y2="2052.7344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="2052.7344" y2="2052.7344"/><polygon fill="#A80036" points="694,2048.7344,684,2052.7344,694,2056.7344,690,2052.7344" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="690" y="2034.6685">no message to handle</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="683" x2="725" y1="2081.8672" y2="2081.8672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="725" x2="725" y1="2081.8672" y2="2094.8672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684" x2="725" y1="2094.8672" y2="2094.8672"/><polygon fill="#A80036" points="694,2090.8672,684,2094.8672,694,2098.8672,690,2094.8672" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="690" y="2076.8013">}</text><polygon fill="#A80036" points="513,2120,503,2124,513,2128,509,2124" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="507" x2="682" y1="2124" y2="2124"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="519" y="2118.9341">msg: end of loop</text><polygon fill="#A80036" points="273,2149.1328,263,2153.1328,273,2157.1328,269,2153.1328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="267" x2="501" y1="2153.1328" y2="2153.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="279" y="2148.0669">longjmp(bluenet)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="262" x2="304" y1="2182.2656" y2="2182.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="304" x2="304" y1="2182.2656" y2="2195.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="304" y1="2195.2656" y2="2195.2656"/><polygon fill="#A80036" points="273,2191.2656,263,2195.2656,273,2199.2656,269,2195.2656" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="269" y="2177.1997">handle commmand end of loop</text><polygon fill="#A80036" points="63,2205.2656,53,2209.2656,63,2213.2656,59,2209.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="261" y1="2209.2656" y2="2209.2656"/><!--MD5=[109bb22c0925a7e6c07648d20305b439]
@startuml

participant "Scheduler"                       as sched
database "Microapp stack"                     as appstack
participant "Bluenet"                         as fw
participant "Bluenet microapp thread"         as fw_app
participant "Microapp"                        as app

note across
Aruino program looks like:

	void setup() {

	}

	void loop() {
		digitalWrite(13, HIGH);
		int powerUsage = getPowerUsage();
		delay(3);
	}
end note

== Setup ==
sched -> fw: tick
fw -> fw_app: longjmp(microapp)
activate appstack

fw_app -> app:
app -> app: no message to handle
app -> app: setup()
app -> fw_app: msg: setup done
fw_app -> fw: longjmp(bluenet)
deactivate appstack

fw -> fw: handle command setup done


== Loop ==
fw -> fw_app: longjmp(microapp)
activate appstack

fw_app -> app:
app -> app: no message to handle
app -> app: loop()
app -> app: digitalWrite(13, HIGH)
app -> fw_app: msg: set pin 13 1
fw_app -> fw: longjmp(bluenet)
deactivate appstack

fw -> fw: handle command: set pin 13 1


== Command with return ==
fw -> fw_app: longjmp(microapp)
activate appstack

fw_app -> app:
app -> app: no message to handle
app -> app: getPowerUsage()
app -> fw_app: msg: get power usage
fw_app -> fw: longjmp(bluenet)
deactivate appstack

fw -> fw: handle command: get power usage

fw -> fw_app: longjmp(microapp)
activate appstack

fw_app -> app: msg: result power usage
app -> app: handle message: result power usage


== Delay ==
app -> app: delay(3)
app -> fw_app:
fw_app -> fw: longjmp(bluenet)
deactivate appstack
fw -> fw: no command to handle
fw -> sched:
 
sched -> fw: tick
fw -> fw_app: longjmp(microapp)
activate appstack
fw_app -> app:
app -> app: no message to handle
app -> app: wait for 2 more ticks
app -> fw_app:
fw_app -> fw: longjmp(bluenet)
deactivate appstack
fw -> fw: no command to handle
fw -> sched:

sched -> fw: tick
fw -> fw_app: longjmp(microapp)
activate appstack
fw_app -> app:
app -> app: no message to handle
app -> app: wait for 1 more tick
app -> fw_app:
fw_app -> fw: longjmp(bluenet)
deactivate appstack
fw -> fw: no command to handle
fw -> sched:

sched -> fw: tick
fw -> fw_app: longjmp(microapp)
activate appstack
fw_app -> app:
app -> app: no message to handle
app -> app: }
app -> fw_app: msg: end of loop
fw_app -> fw: longjmp(bluenet)
deactivate appstack
fw -> fw: handle commmand end of loop
fw -> sched:



@enduml

PlantUML version 1.2020.00(Sat Jan 11 13:30:53 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.13+8-Ubuntu-0ubuntu1.18.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>