<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="856px" preserveAspectRatio="none" style="width:950px;height:856px;" version="1.1" viewBox="0 0 950 856" width="950px" zoomAndPan="magnify"><defs><filter height="300%" id="f1emnveziynw5z" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1emnveziynw5z)" height="213.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="58" y="181.6953"/><rect fill="#FFFFFF" filter="url(#f1emnveziynw5z)" height="129.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="58" y="593.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="63" x2="63" y1="65.2969" y2="782.8203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="164" x2="164" y1="65.2969" y2="782.8203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="398.5" x2="398.5" y1="65.2969" y2="782.8203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="638.5" x2="638.5" y1="65.2969" y2="782.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="8" y="61.9951">Microapp stack</text><path d="M45,13 C45,3 63,3 63,3 C63,3 81,3 81,13 L81,39 C81,49 63,49 63,49 C63,49 45,49 45,39 L45,13 " fill="#FEFECE" filter="url(#f1emnveziynw5z)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M45,13 C45,23 63,23 63,23 C63,23 81,23 81,13 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="8" y="794.8154">Microapp stack</text><path d="M45,808.1172 C45,798.1172 63,798.1172 63,798.1172 C63,798.1172 81,798.1172 81,808.1172 L81,834.1172 C81,844.1172 63,844.1172 63,844.1172 C63,844.1172 45,844.1172 45,834.1172 L45,808.1172 " fill="#FEFECE" filter="url(#f1emnveziynw5z)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M45,808.1172 C45,818.1172 63,818.1172 63,818.1172 C63,818.1172 81,818.1172 81,808.1172 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1emnveziynw5z)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="128" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="135" y="49.9951">Bluenet</text><rect fill="#FEFECE" filter="url(#f1emnveziynw5z)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="128" y="781.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="135" y="801.8154">Bluenet</text><rect fill="#FEFECE" filter="url(#f1emnveziynw5z)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="304.5" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="171" x="311.5" y="49.9951">Bluenet microapp thread</text><rect fill="#FEFECE" filter="url(#f1emnveziynw5z)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="304.5" y="781.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="171" x="311.5" y="801.8154">Bluenet microapp thread</text><rect fill="#FEFECE" filter="url(#f1emnveziynw5z)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="598.5" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="605.5" y="49.9951">Microapp</text><rect fill="#FEFECE" filter="url(#f1emnveziynw5z)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="598.5" y="781.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="605.5" y="801.8154">Microapp</text><rect fill="#FFFFFF" filter="url(#f1emnveziynw5z)" height="213.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="58" y="181.6953"/><rect fill="#FFFFFF" filter="url(#f1emnveziynw5z)" height="129.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="58" y="593.1563"/><rect fill="#EEEEEE" filter="url(#f1emnveziynw5z)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="935" x="3" y="95.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="938" y1="95.8633" y2="95.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="938" y1="98.8633" y2="98.8633"/><rect fill="#EEEEEE" filter="url(#f1emnveziynw5z)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="108" x="416.5" y="85.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="422.5" y="101.3638">Initialization</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="206" y1="139.5625" y2="139.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="206" y1="139.5625" y2="152.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="165" x2="206" y1="152.5625" y2="152.5625"/><polygon fill="#A80036" points="175,148.5625,165,152.5625,175,156.5625,171,152.5625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="171" y="134.4966">Write callback to IPC ram</text><polygon fill="#A80036" points="387,177.6953,397,181.6953,387,185.6953,391,181.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="393" y1="181.6953" y2="181.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="171" y="176.6294">Set stack microapp.</text><polygon fill="#A80036" points="627,206.8281,637,210.8281,627,214.8281,631,210.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="399" x2="633" y1="210.8281" y2="210.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="205.7622">Call microapp start address.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="639" x2="681" y1="239.9609" y2="239.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="681" x2="681" y1="239.9609" y2="252.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="640" x2="681" y1="252.9609" y2="252.9609"/><polygon fill="#A80036" points="650,248.9609,640,252.9609,650,256.9609,646,252.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="646" y="234.895">main(): init global variables.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="639" x2="681" y1="282.0938" y2="282.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="681" x2="681" y1="282.0938" y2="295.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="640" x2="681" y1="295.0938" y2="295.0938"/><polygon fill="#A80036" points="650,291.0938,640,295.0938,650,299.0938,646,295.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="646" y="277.0278">Write callback, write buf, read buf to IPC ram.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="639" x2="681" y1="324.2266" y2="324.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="681" x2="681" y1="324.2266" y2="337.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="640" x2="681" y1="337.2266" y2="337.2266"/><polygon fill="#A80036" points="650,333.2266,640,337.2266,650,341.2266,646,337.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="646" y="319.1606">Read bluenet callback from IPC ram.</text><polygon fill="#A80036" points="410,362.3594,400,366.3594,410,370.3594,406,366.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="404" x2="638" y1="366.3594" y2="366.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="416" y="361.2935">Call bluenet callback.</text><polygon fill="#A80036" points="175,391.4922,165,395.4922,175,399.4922,171,395.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="169" x2="398" y1="395.4922" y2="395.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="181" y="390.4263">Set stack bluenet.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="206" y1="424.625" y2="424.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="206" y1="424.625" y2="437.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="165" x2="206" y1="437.625" y2="437.625"/><polygon fill="#A80036" points="175,433.625,165,437.625,175,441.625,171,437.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="171" y="419.5591">Read microapp data from IPC ram.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="206" y1="466.7578" y2="466.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="206" y1="466.7578" y2="479.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="165" x2="206" y1="479.7578" y2="479.7578"/><polygon fill="#A80036" points="175,475.7578,165,479.7578,175,483.7578,171,479.7578" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="171" y="461.6919">setjmp(microapp)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="206" y1="508.8906" y2="508.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="206" y1="508.8906" y2="521.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="165" x2="206" y1="521.8906" y2="521.8906"/><polygon fill="#A80036" points="175,517.8906,165,521.8906,175,525.8906,171,521.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="171" y="503.8247">setjmp(bluenet)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="206" y1="551.0234" y2="551.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="206" y1="551.0234" y2="564.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="165" x2="206" y1="564.0234" y2="564.0234"/><polygon fill="#A80036" points="175,560.0234,165,564.0234,175,568.0234,171,564.0234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="171" y="545.9575">longjmp(microapp)</text><polygon fill="#A80036" points="387,589.1563,397,593.1563,387,597.1563,391,593.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="393" y1="593.1563" y2="593.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="171" y="588.0903">Set stack microapp</text><polygon fill="#A80036" points="627,618.2891,637,622.2891,627,626.2891,631,622.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="399" x2="633" y1="622.2891" y2="622.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="406" y="617.2231">Call microapp callback.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="639" x2="681" y1="651.4219" y2="651.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="681" x2="681" y1="651.4219" y2="664.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="640" x2="681" y1="664.4219" y2="664.4219"/><polygon fill="#A80036" points="650,660.4219,640,664.4219,650,668.4219,646,664.4219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="646" y="646.356">setup()</text><polygon fill="#A80036" points="410,689.5547,400,693.5547,410,697.5547,406,693.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="404" x2="638" y1="693.5547" y2="693.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="416" y="688.4888">Call bluenet callback(setup done).</text><polygon fill="#A80036" points="175,718.6875,165,722.6875,175,726.6875,171,722.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="169" x2="398" y1="722.6875" y2="722.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="181" y="717.6216">longjmp(bluenet)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="206" y1="751.8203" y2="751.8203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="206" y1="751.8203" y2="764.8203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="165" x2="206" y1="764.8203" y2="764.8203"/><polygon fill="#A80036" points="175,760.8203,165,764.8203,175,768.8203,171,764.8203" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="171" y="746.7544">Handle command setup done.</text><!--MD5=[35b56a6eaa8ac292d66e5098701d37f2]
@startuml

database "Microapp stack"                  as appstack
participant "Bluenet"                         as fw
participant "Bluenet microapp thread"         as fw_app
participant "Microapp"                        as app

== Initialization ==
fw -> fw: Write callback to IPC ram

fw -> fw_app: Set stack microapp.
activate appstack
fw_app -> app: Call microapp start address.

app -> app: main(): init global variables.
app -> app: Write callback, write buf, read buf to IPC ram.
app -> app: Read bluenet callback from IPC ram.
app -> fw_app: Call bluenet callback.
fw_app -> fw: Set stack bluenet.
deactivate appstack

fw -> fw: Read microapp data from IPC ram.

fw -> fw: setjmp(microapp)
fw -> fw: setjmp(bluenet)

fw -> fw: longjmp(microapp)
fw -> fw_app: Set stack microapp
activate appstack

fw_app -> app: Call microapp callback.
app -> app: setup()
app -> fw_app: Call bluenet callback(setup done).
fw_app -> fw: longjmp(bluenet)
deactivate appstack
fw -> fw: Handle command setup done.

@enduml

PlantUML version 1.2020.00(Sat Jan 11 13:30:53 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.13+8-Ubuntu-0ubuntu1.18.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>