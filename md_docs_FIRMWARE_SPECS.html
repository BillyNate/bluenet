<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bluenet: Specs of the bluenet firmware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
	DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bluenet
   &#160;<span id="projectnumber">5.4.0</span>
   </div>
   <div id="projectbrief">Bluenet, the firmware for the Crownstone power outlet</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_FIRMWARE_SPECS.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Specs of the bluenet firmware </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The bluenet firmware does have a lot of sophisticated features:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Dual memory bank   </td><td class="markdownTableBodyNone">On a firmware update, have option to roll back to previous version    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> broadcast with cyclic buffer   </td><td class="markdownTableBodyNone">A cyclic buffer for application specific data in the BLE mesh    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Persistent storage   </td><td class="markdownTableBodyNone">Persistent storage of certain state variables, e.g. switch state    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Flash write optimization   </td><td class="markdownTableBodyNone">Write optimization w.r.t. number of times that can be written to flash    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Buffer reuse   </td><td class="markdownTableBodyNone">Buffer reuse for different purposes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">App-specific scan responses   </td><td class="markdownTableBodyNone">Connection-less messages embedded in service data (scan responses)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Encryption   </td><td class="markdownTableBodyNone">Symmetric keys to encrypt connections and mesh messages   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md170"></a>
Dual memory bank</h1>
<p >An nRF52 chip does have 512 kB flash. The bootloader occupies around 16 kB and the softdevice around 112 kB. This means that there is 400 kB available for the application. The bluenet app uses around 130 kB of that 400 kB, hence it fits comfortably twice into memory. That amount of space can be used to make the upload process of a new application more robust.</p>
<p >A dual memory bank uses the second half of memory to store the new firmware. This firmware is uploaded to the bluenet-compatible device over the air, from a smartphone or laptop. Only when the checks are correct, this firmware will replace the old firmware. This reduces the risk of running firmware that is faulty (due to connections that break halfway the process or individual packet loss).</p>
<h1><a class="anchor" id="autotoc_md171"></a>
Mesh broadcast with cyclic buffer</h1>
<p >The bluenet-compatible devices can talk with each other over separate channels. A device can add additional state information by pushing it to a cyclic buffer that will be automatically broadcasted over all connected devices.</p>
<h1><a class="anchor" id="autotoc_md172"></a>
Persistent storage</h1>
<p >If the bluenet-compatible device is a power switch, it stores the state of a switch after it toggles. This allows someone to turn off the device, or plug it out, and have this information available after a reset.</p>
<h1><a class="anchor" id="autotoc_md173"></a>
Flash write optimization</h1>
<p >To ensure that an individual device has a technical lifetime of 10 years, it is important to not write to the same flash location each time due to wear. On the nRF52 it is possible to write 10 000 times to the same flash location. To increase the number of times you can write a value to flash, it can be stored to multiple locations together with a pointer/counter. Using such a cyclic buffer the lifetime of the flash memory is increased considerably.</p>
<h1><a class="anchor" id="autotoc_md174"></a>
Buffer reuse</h1>
<p >A buffer abstraction that allows for the reuse of RAM for multiple purposes to limit memory use.</p>
<h1><a class="anchor" id="autotoc_md175"></a>
App-specific scan responses</h1>
<p >It is possible to obtain information about energy usage (in an encrypted manner) by encapsulating it in scan responses.</p>
<h1><a class="anchor" id="autotoc_md176"></a>
Encryption</h1>
<p >Regardless of BLE security measures there is payload encryption/decryption using SHA-1.</p>
<h1><a class="anchor" id="autotoc_md177"></a>
Other features</h1>
<p >There are plenty of other software considerations / optimizations.</p>
<ul>
<li>While being connected there are still non-connectable advertisements sent to help with the indoor localization.</li>
<li>Establishing a dimmer is not trivial. Rather than relying on unreliable zero-crossing events either due to jitter or drift, a timer peripheral is gradually adjusted by zero-crossing events. Everything uses the CPU as little as possible. Nordic provides for this the so-called Programmable Peripheral Interconnect (PPI) event system. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
