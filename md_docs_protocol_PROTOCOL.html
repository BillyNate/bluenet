<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bluenet: # Bluenet protocol v5.1</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
	DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bluenet
   &#160;<span id="projectnumber">5.4.0</span>
   </div>
   <div id="projectbrief">Bluenet, the firmware for the Crownstone power outlet</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_protocol_PROTOCOL.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"># Bluenet protocol v5.1 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This only documents the latest protocol, older versions can be found in the git history.</p>
<h1><a class="anchor" id="autotoc_md388"></a>
Index</h1>
<ul>
<li>Setup. How to setup the crownstone.</li>
<li>Encryption. How to encrypt and decrypt the data.</li>
<li>Advertisements. What data is broadcasted by the crownstones.</li>
<li>Broadcast commands. Broadcast commands.</li>
<li>Services and characteristics. Which Bluetooth GATT services and characteristics the crownstones have.</li>
<li>Data structures. The data structures used for the characteristics, advertisements, and mesh.<ul>
<li>Control. Used to send commands to the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.</li>
<li>Result. The result of a command.</li>
<li>State. <a class="el" href="classState.html" title="Stores state values in RAM and/or FLASH.">State</a> variables of the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md389"></a>
Setup mode</h1>
<p >When a <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> is new or factory reset, it will go into setup mode.</p>
<p >The setup process goes as follows:</p>
<ul>
<li><a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> is in setup mode (Setup service active).</li>
<li>Phone connects to the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.</li>
<li>Phone reads the <b>session key</b> from the setup service.</li>
<li>Phone reads the session data from the setup service.</li>
<li>From here on, all writes and read are encrypted using the session key and data, as explained here.</li>
<li>Phone subscribes to result characteristic.</li>
<li>Phone commands <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> to setup via the control characteristic.</li>
<li>Phone waits for result to become SUCCESS (See result packet).</li>
<li><a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> will reboot to normal mode.</li>
</ul>
<h1><a class="anchor" id="autotoc_md390"></a>
Normal mode</h1>
<p >When a <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> has been set up, it will run in "normal mode".</p>
<p >To write a command via connection, the process goes as follows:</p>
<ul>
<li><a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> is in normal mode (Crownstone service active).</li>
<li>Phone connects to the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.</li>
<li>Phone reads the session data from the Crownstone service.</li>
<li>From here on, all writes and read are encrypted using the session key and data, as explained here.</li>
<li>Phone subscribes to result characteristic.</li>
<li>Phone writes a control command to the control characteristic.</li>
<li>Phone waits for result, see result packet.</li>
<li>Next command can be written.</li>
</ul>
<h1><a class="anchor" id="autotoc_md391"></a>
Encryption</h1>
<p >By default, Crownstones have encryption enabled as a security and privacy measure.</p>
<p >What is encrypted:</p>
<ul>
<li>The <a class="el" href="md_docs_protocol_SERVICE_DATA.html">service data</a> is encrypted using the service data key.</li>
<li>Values that are <b>read from</b> the characteristics are encrypted unless specified differently.</li>
<li>Values that are <b>written to</b> the characteristics are encrypted unless specified differently.</li>
<li>Messages over the mesh.</li>
<li>Broadcasted commands.</li>
</ul>
<h2><a class="anchor" id="autotoc_md392"></a>
AES 128 ECB encryption</h2>
<p >Some packets are <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Electronic-Codebook-.28ECB.29">ECB encrypted</a>.</p>
<h2><a class="anchor" id="autotoc_md393"></a>
AES 128 CTR encryption</h2>
<p >We use the <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Counter-.28CTR.29">AES 128 CTR</a> method to encrypt everything that is written to- and read from characteristics. For this you need an 8 byte number called a <b>nonce</b>. The counter starts at 0 for each packet, and is increased by 1 for every block of 16 bytes in the packet.</p>
<h3><a class="anchor" id="autotoc_md394"></a>
Nonce</h3>
<p >The nonce is a combination of 2 pieces: the session nonce and the packet nonce</p>
<p ><img src="../diagrams/nonce.png" alt="Nonce" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Packet nonce   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">Packet nonce, sent with every packet (see encrypted packet). Should be different for each encrypted packet.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Session nonce   </td><td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">Session nonce, should be read when connected, each time you connect.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md395"></a>
Session data</h4>
<p >After connecting, you should first read the session data from the Crownstone service. The session data is ECB encrypted with the basic key, or when in setup mode: the session key. After decryption, you should verify whether you have read and decrypted successfully by checking if the validation is equal to <b>0xCAFEBABE</b>. The session nonce and validation key will be different each time you connect.</p>
<p ><img src="../diagrams/session-data.png" alt="Session data" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Validation   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">0xCAFEBABE as validation.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Protocol   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">The protocol version to use for communication.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Session nonce   </td><td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">The session nonce for this session. Used to encrypt or decrypt packets.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Validation key   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">The validation key for this session. Used to verify decryption/encryption.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Padding   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Zero-padding so that the whole packet is 16 bytes.   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md396"></a>
Reading and writing characteristics</h2>
<p >When reading and writing characteristics, the data is wrapped in an encrypted packet.</p>
<p >After subscribing, notified data will be sent as multipart notifications.</p>
<h3><a class="anchor" id="autotoc_md397"></a>
Multipart notification packet</h3>
<p >When data is sent via notifications, it will be done via multiple notification packets.</p>
<p ><img src="../diagrams/multipart-notification-packet.png" alt="Multipart notification packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Counter   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Part counter: starts at 0, 255 for last packet.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Data part   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Part of the data.   </td></tr>
</table>
<p >Once you received the last packet, you should concatenate all data parts to get the payload (which is usually an encrypted packet).</p>
<h3><a class="anchor" id="autotoc_md398"></a>
Encrypted packet</h3>
<p >Unlike the name suggests, only the payload of this packet is encrypted. The header is used to determine how to decrypt the payload.</p>
<p ><img src="../diagrams/encrypted-packet.png" alt="Encrypted packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Packet nonce   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">First 3 bytes of nonce used for encrypting the payload, see CTR encryption.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">User level   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0: Admin, 1: Member, 2: Basic, 100: <a class="el" href="classSetup.html" title="Setup class.">Setup</a>. This determines which key has been used for encryption.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Encrypted payload   </td><td class="markdownTableBodyNone">Encrypted payload   </td><td class="markdownTableBodyNone">N*16   </td><td class="markdownTableBodyNone">The encrypted payload of N blocks.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md399"></a>
Encrypted payload</h4>
<p ><img src="../diagrams/encrypted-payload.png" alt="Encrypted payload" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Validation key   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Should be equal to the read validation key.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Payload   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Whatever data would have been sent if encryption was disabled.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Padding   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Zero-padding so that the whole packet is of size N*16 bytes.   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md400"></a>
Advertisements</h1>
<p >By default, iBeacon advertisements will be broadcast at a regular interval. On top of that, advertisements with service data are also broadcasted at regular interval. The <a class="el" href="md_docs_protocol_SERVICE_DATA.html">service data</a> contains useful info about the state of the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.</p>
<p >The iBeacon advertisements have a different MAC address, since these advertisements need to have the connectable flag to be unset. The advertisements with service data will use the original MAC address, and will have the connectable flag set. To calculate the MAC address used for iBeacon advertisements, simply subtract 1 from the first byte of the original MAC address (overflow only that byte, so it only changes the first byte).</p>
<h3><a class="anchor" id="autotoc_md401"></a>
iBeacon advertisement packet</h3>
<p >This packet is according to iBeacon spec, see for example <a href="http://www.havlena.net/en/location-technologies/ibeacons-how-do-they-technically-work/">here</a>.</p>
<p ><img src="../diagrams/ibeacon-packet.png" alt="iBeacon packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">AD Length   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Length of the next AD structure.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">AD Type   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0x01: flags.   </td></tr>
</table>
<p>uint8 | Flags | 1 | uint8 | AD Length | 1 | Length of the next AD structure. uint8 | AD Type | 1 | 0xFF: manufacturer specific data. uint16 | Company id | 2 | 0x004C: Apple. uint8 | iBeacon type | 1 | 0x02: iBeacon. uint8 | iBeacon length | 1 | iBeacon struct length (0x15). uint8 | Proximity <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a> | 16 | Configurable number. uint16 | Major | 2 | Configurable number. uint16 | Minor | 2 | Configurable number. int8 | TX power | 1 | Received signal strength at 1 meter.</p>
<h3><a class="anchor" id="autotoc_md402"></a>
Service data advertisement</h3>
<p >This packet contains the state of the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.</p>
<p ><img src="../diagrams/service-data-packet.png" alt="Service data packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">AD Length   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Length of the next AD structure.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">AD Type   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0x01: flags.   </td></tr>
</table>
<p>uint8 | Flags | 1 | uint8 | AD Length | 1 | Length of the next AD structure. uint8 | AD Type | 1 | 0x16: service data with 16 bit service <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a>. uint16 | <a class="el" href="classService.html" title="Service as defined in the GATT Specification.">Service</a> <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a> | 2 | <a class="el" href="classService.html" title="Service as defined in the GATT Specification.">Service</a> <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a>: 0xC001, 0xC002, or 0xC003. The last two are deprecated, see service data doc. <a class="el" href="md_docs_protocol_SERVICE_DATA.html">Service data</a> | <a class="el" href="classService.html" title="Service as defined in the GATT Specification.">Service</a> data | length-3 | <a class="el" href="classService.html" title="Service as defined in the GATT Specification.">Service</a> data, contains state of the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>. uint8 | AD Length | 1 | Length of the next AD structure. uint8 | AD Type | 1 | 0x08: shortened local name. char[] | Name | length-1 | The shortened name of this device.</p>
<h1><a class="anchor" id="autotoc_md403"></a>
Broadcast commands</h1>
<p >Some commands can also be sent via broadcasts. This is the preferred way, as there is no need to connect to the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>, which takes quite some time. The broadcast protocol is documented in the <a class="el" href="md_docs_protocol_BROADCAST_PROTOCOL.html">broadcast protocol</a> document.</p>
<h1><a class="anchor" id="autotoc_md404"></a>
Services</h1>
<p >When connected, the following services are available.</p>
<p >The <code>A</code>, <code>M</code>, and <code>B</code> columns indicate which users can use these characteristics if encryption is enabled. The access can be further restricted per packet.</p>
<ul>
<li>A: Admin</li>
<li>M: Member</li>
<li>B: Basic</li>
</ul>
<p >The following services are available (depending on state and config):</p><ul>
<li>Crownstone service. Contains all you need: control, config and state.</li>
<li>Setup service. Similar to the crownstone service, replaces it when in setup mode.</li>
</ul>
<h2><a class="anchor" id="autotoc_md405"></a>
Crownstone service</h2>
<p >The crownstone service has <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a> 24f00000-7d10-4805-bfc1-7663a01c3bff and provides all the functionality of the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> through the following characteristics:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a class="el" href="classCharacteristic.html" title="A default characteristic.">Characteristic</a>   </th><th class="markdownTableHeadNone"><a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a>   </th><th class="markdownTableHeadNone">Data type   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadCenter">A   </th><th class="markdownTableHeadCenter">M   </th><th class="markdownTableHeadCenter">B    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Session nonce   </td><td class="markdownTableBodyNone">24f0000e-7d10-4805-bfc1-7663a01c3bff   </td><td class="markdownTableBodyNone">Session data   </td><td class="markdownTableBodyNone">Read the session data.   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">ECB    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Control   </td><td class="markdownTableBodyNone">24f0000c-7d10-4805-bfc1-7663a01c3bff   </td><td class="markdownTableBodyNone">Control packet   </td><td class="markdownTableBodyNone">Write a command to the crownstone.   </td><td class="markdownTableBodyCenter">x   </td><td class="markdownTableBodyCenter">x   </td><td class="markdownTableBodyCenter">x    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Result   </td><td class="markdownTableBodyNone">24f0000d-7d10-4805-bfc1-7663a01c3bff   </td><td class="markdownTableBodyNone">Result packet   </td><td class="markdownTableBodyNone">Read the result of a command from the crownstone.   </td><td class="markdownTableBodyCenter">x   </td><td class="markdownTableBodyCenter">x   </td><td class="markdownTableBodyCenter">x   </td></tr>
</table>
<p>Recovery | 24f00009-7d10-4805-bfc1-7663a01c3bff | uint32 | Used for recovery. | | |</p>
<p >Every command written to the control characteristic returns a result packet on the result characteristic. If commands have to be executed sequentially, make sure that the result packet of the previous command was received before calling the next (either by polling or subscribing).</p>
<h4><a class="anchor" id="autotoc_md406"></a>
Recovery</h4>
<p >If you lost your encryption keys you can use this characteristic to factory reset the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>. This method is only available for 60 seconds after the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> powers on. You need to write <b>0xDEADBEEF</b> to it. Then, the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> disconnects and goes into low TX mode so you'll have to be close to continue the factory reset. After this, you reconnect and write <b>0xDEADBEEF</b> again to this characteristic to factory reset the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.</p>
<h2><a class="anchor" id="autotoc_md407"></a>
Setup service</h2>
<p >The setup service has <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a> 24f10000-7d10-4805-bfc1-7663a01c3bff and is only available after a factory reset or when you first power on the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>. When encryption is enabled, the control and both config characteristics are encrypted with <a class="el" href="classAES.html" title="Class that implements AES encryption.">AES</a> CTR. The key and session nonce for this are gotten from their characteristics.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a class="el" href="classCharacteristic.html" title="A default characteristic.">Characteristic</a>   </th><th class="markdownTableHeadNone"><a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a>   </th><th class="markdownTableHeadNone">Data type   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MAC address   </td><td class="markdownTableBodyNone">24f10002-7d10-4805-bfc1-7663a01c3bff   </td><td class="markdownTableBodyNone">uint8[6]   </td><td class="markdownTableBodyNone">Read the MAC address of the crownstone.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Session key   </td><td class="markdownTableBodyNone">24f10003-7d10-4805-bfc1-7663a01c3bff   </td><td class="markdownTableBodyNone">uint8[16]   </td><td class="markdownTableBodyNone">Read the session key that will be for encryption.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Session data   </td><td class="markdownTableBodyNone">24f1000e-7d10-4805-bfc1-7663a01c3bff   </td><td class="markdownTableBodyNone">Session data   </td><td class="markdownTableBodyNone">Read the session data.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Control   </td><td class="markdownTableBodyNone">24f1000c-7d10-4805-bfc1-7663a01c3bff   </td><td class="markdownTableBodyNone">Control packet   </td><td class="markdownTableBodyNone">Write a command to the crownstone.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Result   </td><td class="markdownTableBodyNone">24f1000d-7d10-4805-bfc1-7663a01c3bff   </td><td class="markdownTableBodyNone">Result packet   </td><td class="markdownTableBodyNone">Read the result of a command from the crownstone.   </td></tr>
</table>
<p >Every command written to the control characteristic returns a result packet on the result characteristic. If commands have to be executed sequentially, make sure that the result packet of the previous command was received before calling the next (either by polling or subscribing).</p>
<h1><a class="anchor" id="autotoc_md408"></a>
Data structures</h1>
<p >Index:</p>
<ul>
<li>Control. Used to send commands to the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.</li>
<li>Result. The result of a command.</li>
<li>State. <a class="el" href="classState.html" title="Stores state values in RAM and/or FLASH.">State</a> variables of the <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md409"></a>
Control packet</h2>
<p ><b>If encryption is enabled, this packet must be encrypted using any of the keys where the box is checked.</b></p>
<p ><img src="../diagrams/control-packet.png" alt="Control packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Protocol   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Which protocol the command is. Should be similar to the protocol as received in the session data. Older protocols might be supported, but there's no guarantee.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Command type   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Type of the command.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Size   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Size of the payload in bytes.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Payload   </td><td class="markdownTableBodyNone">Size   </td><td class="markdownTableBodyNone">Payload data, depends on command type.   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md410"></a>
Command types</h2>
<p >The <code>A</code>, <code>M</code>, <code>B</code>, and <code>S</code> columns indicate which users have access to these commands if encryption is enabled. Admin access means the packet is encrypted with the admin key. <a class="el" href="classSetup.html" title="Setup class.">Setup</a> access means the packet is available in setup mode, and encrypted with the temporary setup key, see setup.</p>
<ul>
<li>A: Admin</li>
<li>M: Member</li>
<li>B: Basic</li>
<li>S: <a class="el" href="classSetup.html" title="Setup class.">Setup</a></li>
</ul>
<p >Available command types:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type nr   </th><th class="markdownTableHeadNone">Type name   </th><th class="markdownTableHeadNone">Payload type   </th><th class="markdownTableHeadNone">Result payload   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadCenter">A   </th><th class="markdownTableHeadCenter">M   </th><th class="markdownTableHeadCenter">B   </th><th class="markdownTableHeadCenter">S    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone"><a class="el" href="classSetup.html" title="Setup class.">Setup</a>   </td><td class="markdownTableBodyNone">Setup packet   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Perform setup.   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">x   </td></tr>
</table>
<p>1 | Factory reset | uint32 | - | Reset device to factory setting, needs Code 0xDEADBEEF as payload | x 2 | Get state | State get packet | State get result packet | Required access depends on the state type. | x | x | x 3 | Set state | State set packet | State set result packet | Required access depends on the state type. | x | x | x 4 | Get bootloader version | - | <a href="IPC.md#bootloader-info-packet">Bootloader info packet</a> | Get bootloader version info. | x | x | x | x 5 | Get UICR data | - | UICR data packet | Get the UICR data. | x | x | x | x 6 | Set ibeacon config ID | Ibeacon config ID packet | - | Set the ibeacon config ID that is used. The config values can be set via the <em>Set state</em> command, with corresponding state ID. You can use this command to interleave between config ID 0 and 1. | x | | | 7 | Get MAC address | - | uint8[6] | Get the MAC address of this stone (in reverse byte order compared to string representation). | x | x | x | x 10 | Reset | - | - | Reset device | x 11 | Goto DFU | - | - | Reset device to DFU mode | x 12 | No operation | - | - | Does nothing, merely there to keep the crownstone from disconnecting | x | x | x 13 | Disconnect | - | - | Causes the crownstone to disconnect | x | x | x 20 | Switch | Switch value | - | Switch power. | x | x | x | x | 21 | Multi switch | Multi switch packet | - | Switch multiple Crownstones (via mesh). | x | x | x 22 | <a class="el" href="classDimmer.html" title="Class that provides a dimmer.">Dimmer</a> | uint8 | - | Set dimmer to value, 0 = off, 100 = full on | x | x | x | 23 | <a class="el" href="classRelay.html" title="Class that provides a bi-stable relay.">Relay</a> | uint8 | - | Switch relay, 0 = off, 1 = on | x | x | x 30 | Set time | uint32 | - | Sets the time. Timestamp is in seconds since epoch (Unix time). | x | x | 31 | Increase TX | - | - | Temporarily increase the TX power when in setup mode | | | | x 32 | Reset errors | Error bitmask | - | Reset all errors which are set in the written bitmask. | x 33 | <a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> command | Mesh command packet | - | Send a generic command over the mesh. Required access depends on the command. | x | x | x 34 | Set sun times | Sun time packet | - | Update the reference times for sunrise and sunset | x | x 35 | Get time | - | uint32 | Get the time. Timestamp is in seconds since epoch (Unix time). | x | x | x 36 | Reset RSSI between stones | - | - | Resets the cached RSSI between stones. Will also let the crownstones send the RSSI of their neighbours at a smaller interval. | x 40 | Allow dimming | uint8 | - | Allow/disallow dimming, 0 = disallow, 1 = allow. | x 41 | Lock switch | uint8 | - | Lock/unlock switch, 0 = unlock, 1 = lock. | x 50 | UART message | payload | - | Print the payload to UART. | x 51 | Hub data | Hub data packet | - | Send data to hub over UART. You will first get WAIT_FOR_SUCCESS, when it's sent to the hub. Once the hub processed the command, and replied, you will get the final result. | x 60 | Add behaviour | <a href="BEHAVIOUR.md#add-behaviour-packet">Add behaviour packet</a> | <a href="BEHAVIOUR.md#add-behaviour-result-packet">Index and master hash</a> | Add a behaviour to an unoccupied index. | x | x 61 | Replace behaviour | <a href="BEHAVIOUR.md#replace-behaviour-packet">Replace behaviour packet</a> | <a href="BEHAVIOUR.md#replace-behaviour-result-packet">Index and master hash</a> | Replace the behaviour at given index. | x | x 62 | Remove behaviour | <a href="BEHAVIOUR.md#remove-behaviour-packet">Remove behaviour packet</a> | <a href="BEHAVIOUR.md#remove-behaviour-result-packet">Index and master hash</a> | Remove the behaviour at given index. | x | x 63 | Get behaviour | <a href="BEHAVIOUR.md#get-behaviour-packet">Index</a> | <a href="BEHAVIOUR.md#get-behaviour-result-packet">Index and behaviour packet</a> | Obtain the behaviour stored at given index. | x | x 64 | Get behaviour indices | - | <a href="BEHAVIOUR.md#behaviour-indices-result-packet">Behaviour indices packet</a> | Obtain a list of occupied indices in the list of behaviours. | x | x 69 | Get behaviour debug | - | Behaviour debug packet | Obtain debug info of the current behaviour state. | x 70 | Register tracked device | Register tracked device packet | - | Register or update a device to be tracked. Error codes: ALREADY_EXISTS: another device ID registered the same token. ERR_NO_ACCESS: this device ID was set with a higher access level. ERR_NO_SPACE: max number of devices have been registered. | x | x | x 71 | Tracked device heartbeat | Tracked device heartbeat packet | - | Let the crownstone know where a device is, similar to <a href="BROADCAST_PROTOCOL.md#background-broadcasts">background broadcasts</a>. Error codes: ERR_NOT_FOUND: no device with given device ID was registered, or it was timed out. ERR_NO_ACCESS: wrong access level, or device token. | x | x | x 72 | Get presence | - | Presence packet | Get the current location of each profile. | x | x 80 | Get uptime | - | uint32 | <a class="el" href="classTime.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: Sep 24,...">Time</a> in seconds since boot. | x 81 | Get <a class="el" href="classADC.html" title="Analog-Digital conversion.">ADC</a> restarts | - | ADC restarts packet | <b>Firmware debug.</b> Number of <a class="el" href="classADC.html" title="Analog-Digital conversion.">ADC</a> restarts since boot. | x 82 | Get switch history | - | Switch history packet | <b>Firmware debug.</b> A history of why the switch state has changed. | x 83 | Get power samples | Request power samples | Power samples | <b>Firmware debug.</b> Get the current or voltage samples of certain events. | x 84 | Get min scheduler free space | - | uint16 | <b>Firmware debug.</b> Get minimum queue space left of app scheduler observed so far. A lower number indicates the CPU has been busy a lot. | x 85 | Get last reset reason | - | uint32 | <b>Firmware debug.</b> Contents of POWER-&gt;RESETREAS as it was on boot. Bitmask with bit 0=ResetPin, 1=<a class="el" href="classWatchdog.html" title="Class that implements the watchdog timer.">Watchdog</a>, 2=SoftReset, 3=Lockup, 16=GPIO, 17=LPComp, 18=DebugInterface, 19=NFC. | x 86 | Get GPREGRET | Index (uint8) | Gpregret packet | <b>Firmware debug.</b> Get the Nth general purpose retention register as it was on boot. There are currently 2 registers. | x 87 | Get <a class="el" href="classADC.html" title="Analog-Digital conversion.">ADC</a> channel swaps | - | ADC channel swaps packet | <b>Firmware debug.</b> Get the number of detected <a class="el" href="classADC.html" title="Analog-Digital conversion.">ADC</a> channel swaps. | x 88 | Get RAM statistics | - | RAM stats packet | <b>Firmware debug.</b> Get RAM statistics. | x 90 | Get microapp info | - | Microapp info packet | Get info like supported protocol and SDK, maximum sizes, and the state of uploaded microapps. | x 91 | Upload microapp | Microapp upload packet | - | Upload (a part of) a microapp. | x 92 | Validate microapp | Microapp header packet | - | Validate a microapp. Should be done after upload: checks integrity of the uploaded data. | x 93 | Remove microapp | Microapp header packet | - | Removes a microapp. When result is ERR_WAIT_FOR_SUCCESS, you have to wait for ERR_SUCCESS. In case the microapp is already removed, you will get ERR_SUCCESS_NO_CHANGE. | x 94 | Enable microapp | Microapp header packet | - | Enable a microapp. Should be done after validation: checks SDK version, resets any failed tests, and starts running the microapp. | x 95 | Disable microapp | Microapp header packet | - | Disable a microapp, stops running the microapp. | x 100 | Clean flash | - | - | <b>Firmware debug.</b> Start cleaning flash: permanently deletes removed state variables, and defragments the persistent storage. | x 110 | Upload filter | <a href="ASSET_FILTERING.md#upload-filter-packet">Upload filter packet</a> | - | Upload (a part of) an asset filter. | x 111 | Remove filter | <a href="ASSET_FILTERING.md#remove-filter-packet">Remove filter packet</a> | - | Delete an asset filter. | x 112 | Commit filter changes | <a href="ASSET_FILTERING.md#commit-filter-packet">Commit filter changes packet</a> | - | Commit changes made to the asset filters. | x 113 | Get filter summaries | - | <a href="ASSET_FILTERING.md#get-filter-summaries-result-packet">Get filter summaries packet</a> | Obtain summaries of the stored asset filters. | x</p>
<h4><a class="anchor" id="autotoc_md411"></a>
Setup packet</h4>
<p ><img src="../diagrams/setup-packet.png" alt="Setup packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Stone ID   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"><a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> ID. Should be unique per sphere.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Sphere ID   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Short sphere ID. Should be the same for each <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> in the sphere.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Admin key   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">16 byte key used to encrypt/decrypt admin access functions.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Member key   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">16 byte key used to encrypt/decrypt member access functions.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Basic key   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">16 byte key used to encrypt/decrypt basic access functions.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone"><a class="el" href="classService.html" title="Service as defined in the GATT Specification.">Service</a> data key   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">16 byte key used to encrypt/decrypt service data.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">Localization key   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">16 byte key used to encrypt/decrypt localization messages.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone"><a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> device key   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">16 byte key used to encrypt/decrypt mesh config. Should be different for each <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone"><a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> app key   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">16 byte key used to encrypt/decrypt mesh messages. Should be the same for each <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> in the sphere.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone"><a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> net key   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">16 byte key used to encrypt/decrypt relays of mesh messages. Should be the same for each <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> in the sphere.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">iBeacon <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a>   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">The iBeacon <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a>. Should be the same for each <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> in the sphere.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">iBeacon major   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">The iBeacon major. Together with the minor, should be unique per sphere.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">iBeacon minor   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">The iBeacon minor. Together with the major, should be unique per sphere.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md412"></a>
Switch command value</h4>
<p ><img src="../diagrams/switch-command.png" alt="Switch command" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length in bits   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Command value   </td><td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">Percentage or dedicated command   </td></tr>
</table>
<p >The switch command is not bit-structured, but values up to 0x64 / 01100100b / 100 are used for dimming. All higher values can have special meanings.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0-100   </td><td class="markdownTableBodyNone">Percentage   </td><td class="markdownTableBodyNone">0 for OFF, 100 fully ON, dimmed in between.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">101-252   </td><td class="markdownTableBodyNone">Reserved   </td><td class="markdownTableBodyNone">Reserved for future use.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">253   </td><td class="markdownTableBodyNone">Toggle   </td><td class="markdownTableBodyNone">Switch <code>OFF</code> when currently on, switch to <code>SMART_ON</code> when currently off.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">254   </td><td class="markdownTableBodyNone"><a class="el" href="classBehaviour.html" title="Class to derrive behaviours from, centralizing common variables such as from and until times.">Behaviour</a>   </td><td class="markdownTableBodyNone">Switch to the value according to <em>behaviour</em> rules.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">255   </td><td class="markdownTableBodyNone">Smart on   </td><td class="markdownTableBodyNone">Switch on, the value will be determined by <em>behaviour</em> rules.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md413"></a>
State get packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">State type   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Type of state to get.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">id   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">ID of state to get. Most state types will only have ID 0.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Persistence mode   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Type of persistence mode.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">reserved   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Reserved for future use, must be 0 for now.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md414"></a>
State set packet</h4>
<p >Most configuration changes will only be applied after a reboot.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">State type   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Type of state to set.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">id   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">ID of state to get. Most state types will only have ID 0.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Persistence mode   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Type of persistence mode.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">reserved   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Reserved for future use, must be 0 for now.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Payload   </td><td class="markdownTableBodyNone">N   </td><td class="markdownTableBodyNone">Payload data, depends on state type.   </td></tr>
</table>
<p >Most configuration changes will only be applied after a reboot. Available configurations types:</p>
<h4><a class="anchor" id="autotoc_md415"></a>
State get result packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">State type   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Type of state.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">id   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">ID of state.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Persistence mode   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Type of persistence mode.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">reserved   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Reserved for future use, must be 0 for now.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Payload   </td><td class="markdownTableBodyNone">N   </td><td class="markdownTableBodyNone">Payload data, depends on state type.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md416"></a>
State set result packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">State type   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Type of state.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">id   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">ID of state that was set.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Persistence mode   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Type of persistence mode.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">reserved   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Reserved for future use, must be 0 for now.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md417"></a>
State get persistence mode</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">CURRENT   </td><td class="markdownTableBodyNone">Get value from ram if exists, else from flash if exists, else get default. This is the value used by the firmware.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">STORED   </td><td class="markdownTableBodyNone">Get value from flash, else get default. This value will be used after a reboot.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">FIRMWARE_DEFAULT   </td><td class="markdownTableBodyNone">Get default value.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md418"></a>
State set persistence mode</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">TEMPORARY   </td><td class="markdownTableBodyNone">Set value to ram. This value will be used by the firmware, but lost after a reboot.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">STORED   </td><td class="markdownTableBodyNone">Set value to ram and flash. This value will be used by the firmware, also after a reboot. Overwrites the temporary value.   </td></tr>
</table>
<p ><a class="anchor" id="autotoc_md419"></a> </p><h5>UICR data packet</h5>
<p >This packet is meant for developers. For more information, see <a class="el" href="md_docs_PRODUCT_NAMING.html">Naming</a>.</p>
<p ><img src="../diagrams/uicr_data_packet.png" alt="UICR data packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Board   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">The board version.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Product type   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Type of product.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Region   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Which region the product is for.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Product family   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Product family.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Reserved   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Reserved for future use, will be 0xFF for now.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Hardware patch   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Hardware version patch.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Hardware minor   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Hardware version minor.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Hardware major   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Hardware version major.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Reserved   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Reserved for future use, will be 0xFF for now.   </td></tr>
</table>
<p>uint8 | Product housing | 1 | uint8 | Production week | 1 | Week number. uint8 | Production year | 1 | Last 2 digits of the year. uint8 | Reserved | 1 | Reserved for future use, will be 0xFF for now.</p>
<p ><a class="anchor" id="autotoc_md420"></a> </p><h5>Ibeacon config ID packet</h5>
<p ><img src="../diagrams/ibeacon_config_id_packet.png" alt="Ibeacon config ID packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">ID   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">The ibeacon config ID to set.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Timestamp   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Unix timestamp when the ibeacon config ID should be set (the first time).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Interval   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Interval in seconds when the ibeacon config ID should be set again, after the given timestamp.   </td></tr>
</table>
<ul>
<li>ID can only be 0 or 1.</li>
<li>Set the interval to 0 if you want to set the ibeacon config ID only once, at the given timestamp. Use timestamp 0 if you want it to be set immediately.</li>
<li>To interleave between two config IDs every 60 seconds, you will need two commands. First set ID=0, at timestamp=0 with interval=60, then set ID=1 at timestamp=30 with interval=60.</li>
</ul>
<p ><a class="anchor" id="autotoc_md421"></a> </p><h5>Sun time packet</h5>
<p ><img src="../diagrams/set_sun_time_packet.png" alt="Sun time packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Sunrise   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">The moment when the upper limb of the sun appears on the horizon. Units: seconds since midnight.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Sunset   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">The moment when the upper limb of the Sun disappears below the horizon. Units: seconds since midnight.   </td></tr>
</table>
<p ><a class="anchor" id="autotoc_md422"></a> </p><h5>Multi switch packet</h5>
<p ><img src="../diagrams/multi_switch_packet.png" alt="Multi switch list" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Count   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Number of valid entries.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Multi switch entry[]   </td><td class="markdownTableBodyNone">List   </td><td class="markdownTableBodyNone">Count * 2   </td><td class="markdownTableBodyNone">A list of switch commands.   </td></tr>
</table>
<p ><a class="anchor" id="autotoc_md423"></a> </p><h5>Multi switch entry</h5>
<p ><img src="../diagrams/multi_switch_entry_packet.png" alt="Multi switch short entry" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone"><a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> ID   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">The identifier of the crownstone to which this item is targeted.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Switch value   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">The switch value to be set by the targeted crownstone.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md424"></a>
Error Bitmask</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Bit   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Overcurrent   </td><td class="markdownTableBodyNone">If this is 1, overcurrent was detected.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Overcurrent dimmer   </td><td class="markdownTableBodyNone">If this is 1, overcurrent for the dimmer was detected.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Chip temperature   </td><td class="markdownTableBodyNone">If this is 1, the chip temperature is too high.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone"><a class="el" href="classDimmer.html" title="Class that provides a dimmer.">Dimmer</a> temperature   </td><td class="markdownTableBodyNone">If this is 1, the dimmer temperature is too high.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone"><a class="el" href="classDimmer.html" title="Class that provides a dimmer.">Dimmer</a> on failure   </td><td class="markdownTableBodyNone">If this is 1, the dimmer is broken, in an always (partial) on state.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone"><a class="el" href="classDimmer.html" title="Class that provides a dimmer.">Dimmer</a> off failure   </td><td class="markdownTableBodyNone">If this is 1, the dimmer is broken, in an always (partial) off state.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6-31   </td><td class="markdownTableBodyNone">Reserved   </td><td class="markdownTableBodyNone">Reserved for future use.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md425"></a>
Mesh command packet</h4>
<p >This will not work for every command, because the payload size is limited, and the commands are white listed to be sent via mesh. Current white list:</p><ul>
<li>Factory reset</li>
<li>Reset errors</li>
<li>Reset</li>
<li>Set time</li>
<li>Set state</li>
<li>Uart msg</li>
<li>Set iBeacon config ID</li>
<li>Reset RSSI between stones</li>
<li>Lock switch</li>
<li>Allow dimming</li>
</ul>
<p ><img src="../diagrams/command-mesh-packet.png" alt="Command packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Type   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Type of command, see table below.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Flags   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Options.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Timeout / transmissions   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">When acked: timeout time in seconds. Else: number of times to send the command. 0 to use the default (10s timeout or 3 transmissions).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">ID count   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">The number of stone IDs provided.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8[]   </td><td class="markdownTableBodyNone">List of stone IDs   </td><td class="markdownTableBodyNone">Count   </td><td class="markdownTableBodyNone">IDs of the stones at which this message is aimed. Can be empty, then the command payload follows directly after the count field.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Command payload   </td><td class="markdownTableBodyNone">N   </td><td class="markdownTableBodyNone">The command payload data, which depends on the type.   </td></tr>
</table>
<p ><a class="anchor" id="autotoc_md426"></a> </p><h5><a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> command types</h5>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type nr   </th><th class="markdownTableHeadNone">Type name   </th><th class="markdownTableHeadNone">Payload type   </th><th class="markdownTableHeadNone">Payload description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Control   </td><td class="markdownTableBodyNone">Control   </td><td class="markdownTableBodyNone">Send a control command over the mesh, see control packet.   </td></tr>
</table>
<p ><a class="anchor" id="autotoc_md427"></a> </p><h5><a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> command flags</h5>
<p >For now there are only a couple of combinations possible:</p>
<ul>
<li>If you want to send a command to all stones in the mesh, without acks and retries, set: <code>Broadcast=true</code>, <code>AckIDs=false</code>, <code>KnownIDs=false</code>.</li>
<li>If you want to send a command to all stones in the mesh, with acks and retries, set: <code>Broadcast=true</code>, <code>AckIDs=true</code>, <code>KnownIDs=false</code>. You will have to provide the list of IDs yourself.</li>
<li>If you want to send a command to 1 stone, with acks and retries, set: <code>Broadcast=false</code>, <code>AckIDs=true</code>, <code>KnownIDs=false</code>.</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Bit   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Broadcast   </td><td class="markdownTableBodyNone">Send command to all stones. Else, its only sent to all stones in the list of stone IDs, which will take more time.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Ack all IDs   </td><td class="markdownTableBodyNone">Retry until an ack is received from all stones in the list of stone IDs, or until timeout. If you specify more than 1 IDs, only small command payloads will work for most command types.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Use known IDs   </td><td class="markdownTableBodyNone">Instead of using the provided stone IDs, use the stone IDs that this stone has seen. <b>Not implemented yet.</b>   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md428"></a>
Hub data packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Encrypted   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Whether the data should be sent encrypted over the UART: 0 = not encrypted, 1 = encrypt when encryption is enabled, 2 = encrypt or fail.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Reserved   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Reserved for future use. Must be 0 for now.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Payload   </td><td class="markdownTableBodyNone">N   </td><td class="markdownTableBodyNone">Payload data to be sent to hub.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md429"></a>
Presence packet</h4>
<p >A profile can be present at multiple locations/rooms.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint64[]   </td><td class="markdownTableBodyNone">Presence   </td><td class="markdownTableBodyNone">64   </td><td class="markdownTableBodyNone">Bitmask per profile (there are 8 profiles) of occupied rooms. If the Nth bit is set, the profile is present in the Nth room. If bit 0 is set, the profile is present in sphere.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md430"></a>
Behaviour debug packet</h4>
<p ><img src="../diagrams/behaviour_debug_packet.png" alt="Behaviour debug packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone"><a class="el" href="classTime.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: Sep 24,...">Time</a>   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Current time. 0 if not set.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Sunrise   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Sunrise time, seconds after midnight. 0 if not set.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Sunset   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Sunset time, seconds after midnight. 0 if not set.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Override state   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Override state. 254 if not set.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone"><a class="el" href="classBehaviour.html" title="Class to derrive behaviours from, centralizing common variables such as from and until times.">Behaviour</a> state   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"><a class="el" href="classBehaviour.html" title="Class to derrive behaviours from, centralizing common variables such as from and until times.">Behaviour</a> state. 254 if not set.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Aggregated state   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Aggregated state. 254 if not set.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone"><a class="el" href="classDimmer.html" title="Class that provides a dimmer.">Dimmer</a> powered   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Whether the dimmer is powered.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone"><a class="el" href="classBehaviour.html" title="Class to derrive behaviours from, centralizing common variables such as from and until times.">Behaviour</a> enabled   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Whether behaviour is enabled.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint64   </td><td class="markdownTableBodyNone">Stored behaviours   </td><td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">Bitmask of behaviours that are stored. Nth bit is Nth behaviour index.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint64   </td><td class="markdownTableBodyNone">Active behaviours   </td><td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">Bitmask of behaviours that are currently active. Nth bit is Nth behaviour index.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint64   </td><td class="markdownTableBodyNone">Active end conditions   </td><td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">Bitmask of behaviours with active end conditions. Nth bit is Nth behaviour index.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint64   </td><td class="markdownTableBodyNone">Active timeout periods   </td><td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">Bitmask of behaviours that are in (presence) timeout period. Nth bit is Nth behaviour index.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint64[]   </td><td class="markdownTableBodyNone">Presence   </td><td class="markdownTableBodyNone">64   </td><td class="markdownTableBodyNone">Same as (presence packet)(#presence-packet).   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md431"></a>
ADC restarts packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Restart count   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Number of <a class="el" href="classADC.html" title="Analog-Digital conversion.">ADC</a> restarts since boot.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Timestamp   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Unix timestamp of the last <a class="el" href="classADC.html" title="Analog-Digital conversion.">ADC</a> restart.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md432"></a>
ADC channel swaps packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Swap count   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Number of detected <a class="el" href="classADC.html" title="Analog-Digital conversion.">ADC</a> channel swaps since boot.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Timestamp   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Unix timestamp of the last detected <a class="el" href="classADC.html" title="Analog-Digital conversion.">ADC</a> channel swap.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md433"></a>
GPREGRET result packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Index   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Which GPREGRET.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Value   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Value of this GPREGRET. For index 0: bits 0-4 are used to count resets, bit 5 is set on brownout (doesn't work yet), bit 6 is set to go to DFU mode, bit 7 is set after storage was recovered.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md434"></a>
RAM stats packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Min stack end   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Minimal observed stack end pointer since boot. It might take some time before this reflects the actual minimum.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Max heap end   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Maximal observed heap end pointer since boot.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Min free   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Minimal observed free RAM in bytes. It might take some time before this reflects the actual minimum.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Sbrk fail count   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Number of times sbrk failed to hand out space.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md435"></a>
Switch history packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Count   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Number of items in the list.   </td></tr>
</table>
<p>Switch history item[] | List |</p>
<p ><a class="anchor" id="autotoc_md436"></a> </p><h5>Switch history item packet</h5>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Timestamp   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Unix timestamp of the switch command.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Switch command   </td><td class="markdownTableBodyNone">Switch command   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">The switch command value.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Switch state   </td><td class="markdownTableBodyNone">Switch state   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">The switch state after the command was executed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Command source   </td><td class="markdownTableBodyNone">Source   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">The source of the switch command.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md437"></a>
Command source packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length in bits   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Source type   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">What type of source ID. Bits 5-7.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Reserved   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Reserved for future use, must be 0 for now. Bits 1-4.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bool   </td><td class="markdownTableBodyNone">External   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Whether the command was received via the mesh. Bit 0.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Source ID   </td><td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">The ID of the source.   </td></tr>
</table>
<p ><a class="anchor" id="autotoc_md438"></a> </p><h5>Command source type</h5>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Enum   </td><td class="markdownTableBodyNone">ID is one of the list.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"><a class="el" href="classBehaviour.html" title="Class to derrive behaviours from, centralizing common variables such as from and until times.">Behaviour</a>   </td><td class="markdownTableBodyNone">ID is the behaviour index, or 255 when unknown.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">Broadcast   </td><td class="markdownTableBodyNone">ID is the <a href="BROADCAST_PROTOCOL.md#command-broadcast-header">device ID</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Uart   </td><td class="markdownTableBodyNone">ID is the device ID   </td></tr>
</table>
<p ><a class="anchor" id="autotoc_md439"></a> </p><h5>Command source ID</h5>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">None   </td><td class="markdownTableBodyNone">No source was set.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Internal   </td><td class="markdownTableBodyNone">Some internal source, not very specific.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">UART   </td><td class="markdownTableBodyNone">Command came from UART.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Connection   </td><td class="markdownTableBodyNone">Command came from a BLE connection.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">Switchcraft   </td><td class="markdownTableBodyNone">Switchcraft triggered this command.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">Tap to toggle   </td><td class="markdownTableBodyNone">Tap to toggle triggered this command.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md440"></a>
Power samples request packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Type   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Type of samples.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Index   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Some types have multiple lists of samples.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md441"></a>
Power samples type</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Triggered switchcraft   </td><td class="markdownTableBodyNone">Last samples that triggered switchcraft. Has N lists of subsequent voltage samples (index 0 is the first list). You can assume the time between the last sample of the first list and the first sample of the second list is equal to sample interval. Keep reading the next index until you get result code WRONG_PARAMETER.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Non-triggered switchcraft   </td><td class="markdownTableBodyNone">Last samples that almost triggered switchcraft. Has N lists of subsequent voltage samples (index 0 is the first list). You can assume the time between the last sample of the first list and the first sample of the second list is equal to sample interval. Keep reading the next index until you get result code WRONG_PARAMETER.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Now filtered   </td><td class="markdownTableBodyNone">Last sampled values, after smoothing. Has 2 lists: index 0 for voltage, index 1 for current.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">Now unfiltered   </td><td class="markdownTableBodyNone">Last sampled values, before smoothing. Has 2 lists: index 0 for voltage, index 1 for current.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Soft fuse   </td><td class="markdownTableBodyNone">Last samples that triggered a soft fuse. Has 1 list: index 0 for current.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">Switch event   </td><td class="markdownTableBodyNone">Last samples around a switch event. Has N lists: even index for voltage samples, uneven index for current samples.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md442"></a>
Power samples result packet</h4>
<p >background broadcast <img src="../diagrams/power_samples_result_packet.png" alt="Power samples result packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Type   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Type of samples, also determines whether the samples are voltage or current samples.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Index   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Some types have multiple lists of samples, see the type description.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Count   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Number of samples in the list.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Timestamp   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Unix timestamp of time the samples have been set.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Delay   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Measurement delay in μs, due to hardware. A sample measured now, will get the value of delay μs ago. Not set yet, will be 0.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Sample interval   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Sample interval in μs.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Reserved   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Reserved for future use, should be 0 for now.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">int16   </td><td class="markdownTableBodyNone">Offset   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Calculated offset of the samples. (Sort of the average of the sample values). Not set yet, will be 0.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">float   </td><td class="markdownTableBodyNone">Multiplier   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Multiply the sample value minus offset with this value to get a value in ampere (when samples are current), or volt (when samples are voltage). Not set yet, will be 0.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">int16[]   </td><td class="markdownTableBodyNone">Samples   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">List of samples.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md443"></a>
Register tracked device packet</h4>
<p ><img src="../diagrams/register_tracked_device_packet.png" alt="Register tracked device packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Device ID   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Unique ID of the device.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Location ID   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">ID of the location where the device is. 0 for in sphere, but no specific location.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Profile ID   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Profile ID of the device.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">int8   </td><td class="markdownTableBodyNone">RSSI offset   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Offset from standard signal strength.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Flags   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"><a href="BROADCAST_PROTOCOL.md#background-broadcast-flags">Flags</a>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint24   </td><td class="markdownTableBodyNone">Device token   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">Token that will be advertised by the device.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone"><a class="el" href="classTime.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: Sep 24,...">Time</a> to live   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone"><a class="el" href="classTime.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: Sep 24,...">Time</a> in minutes after which the device token will be invalid.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md444"></a>
Tracked device heartbeat packet</h4>
<p ><img src="../diagrams/tracked_device_heartbeat_packet.png" alt="Tracked device heartbeat packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Device ID   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Unique ID of the device.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Location ID   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">ID of the location where the device is. 0 for in sphere, but no specific location.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint24   </td><td class="markdownTableBodyNone">Device token   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">Token that has been registered.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone"><a class="el" href="classTime.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: Sep 24,...">Time</a> to live   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">How long (in minutes) the crownstone assumes the device is at the given location, so should best be larger than the interval at which the heartbeat is sent. Setting this to 0 is similar to sending a single <a href="BROADCAST_PROTOCOL.md#background-broadcasts">background broadcast</a>. Currently the max is 60, a longer time will result in an error WRONG_PARAMETER.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md445"></a>
Microapp header packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Protocol   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Protocol of the microapp command and result packets, should match what you get from the microapp info packet.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">App index   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Index of the microapp on this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md446"></a>
Microapp upload packet</h4>
<p ><img src="../diagrams/microapp_upload_packet.png" alt="Microapp upload packet" class="inline"/></p>
<p >Type | Name | Length | Description -&mdash; | -&mdash; | ---&mdash; | --------&mdash; Microapp header | Header | 2 | uint16 | Offset | 2 | Offset in bytes of this chunk of data. Must be a multiple of 4. uint8[] | Data chunk | N | A chunk of the binary.</p>
<p >For example, if the microapp binary is 299 byte, and your chunks are 128 byte, then you have 3 upload commands with offsets: 0, 128, 256. The last command will have 44 byte of data: the remaining 43 byte, padded to 44 byte, so it is a multiple of 4.</p>
<p >From the get info command, you know which index to use, and what protocol, sdk, and sizes are supported.</p>
<p >When result is ERR_WAIT_FOR_SUCCESS, you have to wait for the result to change to ERR_SUCCESS. In case the stored data matches what you upload, you will get ERR_SUCCESS_NO_CHANGE. If the stored data does not match, you will get ERR_WRITE_DISABLED, meaning you should first remove the current microapp.</p>
<h4><a class="anchor" id="autotoc_md447"></a>
Microapp info packet</h4>
<p ><img src="../diagrams/microapp_info_packet.png" alt="Microapp info packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Protocol   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Supported protocol of the microapp command and result packets.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Max apps   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Maximum number of microapps.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Max app size   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Maximum binary size of a microapp.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Max chunk size   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Maximum chunk size for uploading a microapp.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Max ram usage   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Maximum RAM usage of a microapp.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SDK version   </td><td class="markdownTableBodyNone">SDK version   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">SDK version the firmware supports.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">App status[]   </td><td class="markdownTableBodyNone">App status   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><a class="el" href="structStatus.html" title="Status of a Characteristic.">Status</a> of all microapps, no matter how many have been uploaded.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md448"></a>
Microapp SDK version packet</h4>
<p >The microapp SDK version determines the API for communication between bluenet firmware and microapps.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Major   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Major version: different major indicates breaking changes.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Minor   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Minor version: higher minor means more features.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md449"></a>
Microapp status packet</h4>
<p ><img src="../diagrams/microapp_status_packet.png" alt="Microapp status packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Build version   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Build version of this microapp, should increase each release.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SDK version   </td><td class="markdownTableBodyNone">SDK version   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">SDK version this microapp was built for.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Checksum   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">CRC-16-CCITT of the binary, after the header.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Checksum header   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">CRC-16-CCITT of the binary header.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">tests   </td><td class="markdownTableBodyNone">Tests   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone"><a class="el" href="classState.html" title="Stores state values in RAM and/or FLASH.">State</a> of tests that have been performed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Trying function   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Index of registered function that didn't pass yet, and that we are calling now. 255 for none.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Failed function   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Index of registered function that was tried, but didn't pass. 255 for none.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Passed functions   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Bitmask of registered functions that were called and returned to firmware successfully.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md450"></a>
Microapp tests packet</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Bit   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">hasData   </td><td class="markdownTableBodyNone">Whether the storage space of this app contains data.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1-2   </td><td class="markdownTableBodyNone">checksum   </td><td class="markdownTableBodyNone">0=untested, 1=trying, 2=failed, 3=passed.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">enabled   </td><td class="markdownTableBodyNone">0=disabled, 1=enabled.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4-5   </td><td class="markdownTableBodyNone">boot   </td><td class="markdownTableBodyNone">0=untested, 1=trying, 2=failed, 3=passed.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">memory   </td><td class="markdownTableBodyNone">0=ok, 1=excessive    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">7-15   </td><td class="markdownTableBodyNone">reserved   </td><td class="markdownTableBodyNone">Reserved, must be 0 for now.   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md451"></a>
Result packet</h2>
<p ><b>If encryption is enabled, this packet will be encrypted using any of the keys where the box is checked.</b></p>
<p ><img src="../diagrams/result-packet.png" alt="Result packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Protocol   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Which protocol the result is. Should be similar to the protocol in the control packet.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Command type   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Type of the command of which this packet is the result.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Result code   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">The result code.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">Size   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Size of the payload in bytes.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">Payload   </td><td class="markdownTableBodyNone">Size   </td><td class="markdownTableBodyNone">Payload data, depends on command type.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md452"></a>
Result codes</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">SUCCESS   </td><td class="markdownTableBodyNone">Completed successfully.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">WAIT_FOR_SUCCESS   </td><td class="markdownTableBodyNone">Command is successful so far, but you need to wait for SUCCESS.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">SUCCESS_NO_CHANGE   </td><td class="markdownTableBodyNone">Command is successful, but nothing changed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">BUFFER_UNASSIGNED   </td><td class="markdownTableBodyNone">No buffer was assigned for the command.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">17   </td><td class="markdownTableBodyNone">BUFFER_LOCKED   </td><td class="markdownTableBodyNone">Buffer is locked, failed queue command.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">18   </td><td class="markdownTableBodyNone">BUFFER_TOO_SMALL   </td><td class="markdownTableBodyNone">Buffer is too small for operation.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">19   </td><td class="markdownTableBodyNone">NOT_ALIGNED   </td><td class="markdownTableBodyNone">Buffer is not aligned.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">32   </td><td class="markdownTableBodyNone">WRONG_PAYLOAD_LENGTH   </td><td class="markdownTableBodyNone">Wrong payload length provided.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">33   </td><td class="markdownTableBodyNone">WRONG_PARAMETER   </td><td class="markdownTableBodyNone">Wrong parameter provided.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">34   </td><td class="markdownTableBodyNone">INVALID_MESSAGE   </td><td class="markdownTableBodyNone">invalid message provided.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">35   </td><td class="markdownTableBodyNone">UNKNOWN_OP_CODE   </td><td class="markdownTableBodyNone">Unknown operation code provided.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">36   </td><td class="markdownTableBodyNone">UNKNOWN_TYPE   </td><td class="markdownTableBodyNone">Unknown type provided.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">37   </td><td class="markdownTableBodyNone">NOT_FOUND   </td><td class="markdownTableBodyNone">The thing you were looking for was not found.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">38   </td><td class="markdownTableBodyNone">NO_SPACE   </td><td class="markdownTableBodyNone">There is no space for this command.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">39   </td><td class="markdownTableBodyNone">BUSY   </td><td class="markdownTableBodyNone">Wait for something to be done. You can usually retry later.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">40   </td><td class="markdownTableBodyNone">WRONG_STATE   </td><td class="markdownTableBodyNone">The crownstone is in a wrong state.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">41   </td><td class="markdownTableBodyNone">ALREADY_EXISTS   </td><td class="markdownTableBodyNone">Item already exists.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">42   </td><td class="markdownTableBodyNone">TIMEOUT   </td><td class="markdownTableBodyNone">Operation timed out.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">43   </td><td class="markdownTableBodyNone">CANCELED   </td><td class="markdownTableBodyNone">Operation was canceled.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">44   </td><td class="markdownTableBodyNone">PROTOCOL_UNSUPPORTED   </td><td class="markdownTableBodyNone">The protocol is not supported.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">45   </td><td class="markdownTableBodyNone">MISMATCH   </td><td class="markdownTableBodyNone">There is a mismatch, usually in CRC/checksum/hash.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">46   </td><td class="markdownTableBodyNone">WRONG_OPERATION   </td><td class="markdownTableBodyNone">Another operation was expected.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">48   </td><td class="markdownTableBodyNone">NO_ACCESS   </td><td class="markdownTableBodyNone">Invalid access for this command.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">49   </td><td class="markdownTableBodyNone">UNSAFE   </td><td class="markdownTableBodyNone">It's unsafe to execute this command.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">64   </td><td class="markdownTableBodyNone">NOT_AVAILABLE   </td><td class="markdownTableBodyNone">Command currently not available.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">65   </td><td class="markdownTableBodyNone">NOT_IMPLEMENTED   </td><td class="markdownTableBodyNone">Command not implemented (not yet or not anymore).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">67   </td><td class="markdownTableBodyNone">NOT_INITIALIZED   </td><td class="markdownTableBodyNone">Something must first be initialized.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">68   </td><td class="markdownTableBodyNone">NOT_STARTED   </td><td class="markdownTableBodyNone">Something must first be started.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">69   </td><td class="markdownTableBodyNone">NOT_POWERED   </td><td class="markdownTableBodyNone">Something must first be powered.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">70   </td><td class="markdownTableBodyNone">WRONG_MODE   </td><td class="markdownTableBodyNone">Something is in the wrong operation mode.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">80   </td><td class="markdownTableBodyNone">WRITE_DISABLED   </td><td class="markdownTableBodyNone">Write is disabled for given type.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">81   </td><td class="markdownTableBodyNone">WRITE_NOT_ALLOWED   </td><td class="markdownTableBodyNone">Direct write is not allowed for this type, use command instead.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">82   </td><td class="markdownTableBodyNone">READ_FAILED   </td><td class="markdownTableBodyNone">Failed to read.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">96   </td><td class="markdownTableBodyNone">ADC_INVALID_CHANNEL   </td><td class="markdownTableBodyNone">Invalid adc input channel selected.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">112   </td><td class="markdownTableBodyNone">EVENT_UNHANDLED   </td><td class="markdownTableBodyNone">The event or command was not handled.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">128   </td><td class="markdownTableBodyNone">GATT_ERROR   </td><td class="markdownTableBodyNone">An error occured during a BLE connection.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">65535   </td><td class="markdownTableBodyNone">UNSPECIFIED   </td><td class="markdownTableBodyNone">Unspecified error.   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md453"></a>
State types</h2>
<p >The <code>A</code>, <code>M</code>, <code>B</code>, and <code>S</code> columns indicate which users have access to these states: <code>r</code> for read access, <code>w</code> for write access. Admin access means the packet is encrypted with the admin key. <a class="el" href="classSetup.html" title="Setup class.">Setup</a> access means the packet is available in setup mode, and encrypted with the temporary setup key, see setup.</p>
<ul>
<li>A: Admin</li>
<li>M: Member</li>
<li>B: Basic</li>
<li>S: <a class="el" href="classSetup.html" title="Setup class.">Setup</a></li>
</ul>
<p >Type nr | Type name | Payload type | Payload description | A | M | B ----&mdash; | ------&mdash; | ---------&mdash; | ----------------&mdash; | &mdash; | &mdash; | &mdash; 5 | <a class="el" href="classPWM.html" title="Pulse Wide Modulation class.">PWM</a> period | uint32 | Sets <a class="el" href="classPWM.html" title="Pulse Wide Modulation class.">PWM</a> period in μs for the dimmer. <b>Setting this to a wrong value may cause damage.</b> | rw | | 6 | iBeacon major | uint16 | iBeacon major number. | rw | | 7 | iBeacon minor | uint16 | iBeacon minor number. | rw | | 8 | iBeacon <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a> | uint8 [16] | iBeacon <a class="el" href="classUUID.html" title="Class that enables the use of 128 bit service UUIDs.">UUID</a>. | rw | | 9 | iBeacon TX power | int8 | iBeacon signal strength at 1 meter. | rw | | 11 | TX power | int8 | TX power, can be: -40, -20, -16, -12, -8, -4, 0, or 4. | rw | | 12 | Advertisement interval | uint16 | Advertisement interval between 0x0020 and 0x4000 in units of 0.625 ms. | rw | | 16 | Scan duration | uint16 | Scan duration in ms. Only used by interval scanner, which isn't used by default. <b>Deprecated</b> | rw | | 18 | Scan break duration | uint16 | Waiting time in ms to start next scan. Only used by interval scanner, which isn't used by default. <b>Deprecated</b> | rw | | 19 | Boot delay | uint16 | <a class="el" href="classTime.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: Sep 24,...">Time</a> to wait with radio after boot (ms). <b>Setting this to a wrong value may cause damage.</b> | rw | | 20 | Max chip temp | int8 | If the chip temperature (in degrees Celcius) goes above this value, the power gets switched off. <b>Setting this to a wrong value may cause damage.</b> | rw | | 24 | <a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> enabled | uint8 | Whether mesh is enabled. | rw | | 25 | Encryption enabled | uint8 | Whether encryption is enabled. <b>Not implemented</b> | | | 26 | iBeacon enabled | uint8 | Whether iBeacon is enabled. <b>Not implemented</b> | | | 27 | <a class="el" href="classScanner.html" title="Scanner scans for BLE devices.">Scanner</a> enabled | uint8 | Whether device scanning is enabled. | rw | | 33 | Sphere id | uint8 | Short id of the sphere this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> is part of. | rw | | 34 | <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> id | uint8 | <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> identifier used in advertisement package. | rw | | 35 | Admin key | uint8 [16] | 16 byte key used to encrypt/decrypt owner access functions. | | | 36 | Member key | uint8 [16] | 16 byte key used to encrypt/decrypt member access functions. | | | 37 | Basic key | uint8 [16] | 16 byte key used to encrypt/decrypt basic access functions. | | | 39 | Scan interval | uint16 | The scan interval in units of 0.625 millisecond. Only used by interval scanner, which isn't used by default. | rw | | 40 | Scan window | uint16 | The scan window to in units of 0.625 millisecond. Only used by interval scanner, which isn't used by default. | rw | | 41 | <a class="el" href="classRelay.html" title="Class that provides a bi-stable relay.">Relay</a> high duration | uint16 | The time/duration that the relay is powered for a switch (ms). <b>Setting this to a wrong value may cause damage.</b> | rw | | 42 | Low TX power | int8 | The TX power used when in low transmission power for bonding (can be: -40, -20, -16, -12, -8, -4, 0, or 4). | rw | | 43 | Voltage multiplier | float | Voltage multiplier (for power measurement). <b>Setting this to a wrong value may cause damage.</b> | rw | | 44 | Current multiplier | float | Current multiplier (for power measurement). <b>Setting this to a wrong value may cause damage.</b> | rw | | 45 | Voltage zero | int32 | Voltage zero level (for power measurement). <b>Setting this to a wrong value may cause damage.</b> | rw | | 46 | Current zero | int32 | Current zero level (for power measurement). <b>Setting this to a wrong value may cause damage.</b> | rw | | 47 | Power zero | int32 | Power zero level in mW (for power measurement). <b>Setting this to a wrong value may cause damage.</b> | rw | | 50 | Current consumption threshold | uint16 | At how much mA the switch will be turned off (soft fuse). <b>Setting this to a wrong value may cause damage.</b> | rw | | 51 | Current consumption threshold dimmer | uint16 | At how much mA the dimmer will be turned off (soft fuse). <b>Setting this to a wrong value may cause damage.</b> | rw | | 52 | <a class="el" href="classDimmer.html" title="Class that provides a dimmer.">Dimmer</a> temp up voltage | float | Voltage of upper threshold of the dimmer thermometer. <b>Setting this to a wrong value may cause damage.</b> | rw | | 53 | <a class="el" href="classDimmer.html" title="Class that provides a dimmer.">Dimmer</a> temp down voltage | float | Voltage of lower threshold of the dimmer thermometer. <b>Setting this to a wrong value may cause damage.</b> | rw | | 54 | Dimming allowed | uint8 | Whether this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> is allowed to dim. | rw | | 55 | Switch locked | uint8 | Whether this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> is allowed to change the switch state. | rw | | 56 | Switchcraft enabled | uint8 | Whether this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a> has switchcraft enabled. | rw | | 57 | Switchcraft threshold | float | Sets the threshold for switchcraft. A higher threshold will generally make it less likely to detect a switch (less true and false positives). <b>Setting this to a wrong value may cause damage.</b> | rw | | 59 | UART enabled | uint8 | Whether UART is enabled, 0 = none, 1 = RX only, 3 = TX and RX. | rw | | 60 | Device name | char[] | Name of the device. | rw | | 61 | <a class="el" href="classService.html" title="Service as defined in the GATT Specification.">Service</a> data key | uint8 [16] | 16 byte key used to encrypt/decrypt service data. | | | 62 | <a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> device key | uint8 [16] | 16 byte key used to encrypt/decrypt mesh messages to configure this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>. | | | 63 | <a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> application key | uint8 [16] | 16 byte key used to encrypt/decrypt mesh messages for the application of this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>. | | | 64 | <a class="el" href="classMesh.html" title="Author: Crownstone Team Copyright: Crownstone (https://crownstone.rocks) Date: 12 Apr....">Mesh</a> network key | uint8 [16] | 16 byte key used to encrypt/decrypt mesh messages to be received or relayed by this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>. | | | 65 | Localization key | uint8 [16] | 16 byte key used to encrypt/decrypt messages to tell your location to this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>. | | | 66 | Start dimmer on zero crossing | uint8 | Whether the dimmer should start on a zero crossing or not. | rw | | 67 | Tap to toggle enabled | uint8 | Whether tap to toggle is enabled on this <a class="el" href="classCrownstone.html" title="Crownstone encapsulates all functionality, stack, services, and configuration.">Crownstone</a>. | rw | | 68 | Tap to toggle RSSI threshold offset | int8 | RSSI threshold offset from default, above which tap to toggle will respond. | rw | | 128 | Reset counter | uint16 | Counts the number of resets. | r | r | 129 | Switch state | uint8 | Current switch state. | r | r | 130 | Accumulated energy | int64 | Accumulated energy in μJ. | r | r | 131 | Power usage | int32 | Current power usage in mW. | r | r | 134 | Operation Mode | uint8 | Internal usage. | | | 135 | Temperature | int8 | Chip temperature in °C. | r | r | 139 | Error bitmask | uint32 | Bitmask with errors. | r | r | 149 | Sun time | Sun time packet | Packet with sun rise and set times. | r | r | 150 | <a class="el" href="classBehaviour.html" title="Class to derrive behaviours from, centralizing common variables such as from and until times.">Behaviour</a> settings | Behaviour settings | <a class="el" href="classBehaviour.html" title="Class to derrive behaviours from, centralizing common variables such as from and until times.">Behaviour</a> settings. | rw | rw | r 156 | Soft on speed | uint8 | Speed at which the dimmer goes towards the target value. Range: 1-100. | rw 157 | Hub mode | uint8 | Whether hub mode is enabled. | rw 158 | UART key | uint8 [16] | 16 byte key used to encrypt/decrypt UART messages. | rw 167 | Switchcraft double tap enabled | uint8 | Whether switchcraft double tap is enabled. | rw 168 | Default dim value | uint8 | The default dim value: 0 - 99. Set to 0 for none. Currently only used for double switchcraft. | rw</p>
<h4><a class="anchor" id="autotoc_md454"></a>
Switch state</h4>
<p >To be able to distinguish between the relay and dimmer state, the switch state is a bit struct with the following layout:</p>
<p ><img src="../diagrams/switch_state_packet.png" alt="Switch state packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length in bits   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bool   </td><td class="markdownTableBodyNone"><a class="el" href="classRelay.html" title="Class that provides a bi-stable relay.">Relay</a>   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Value of the relay, where 0 = OFF, 1 = ON.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone"><a class="el" href="classDimmer.html" title="Class that provides a dimmer.">Dimmer</a>   </td><td class="markdownTableBodyNone">7   </td><td class="markdownTableBodyNone">Value of the dimmer, where 100 if fully on, 0 is OFF, dimmed in between.   </td></tr>
</table>
<p ><a class="anchor" id="autotoc_md455"></a> </p><h5><a class="el" href="classBehaviour.html" title="Class to derrive behaviours from, centralizing common variables such as from and until times.">Behaviour</a> settings</h5>
<p ><img src="../diagrams/behaviour_settings_packet.png" alt="Behaviour settings packet" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Flags   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Flags.   </td></tr>
</table>
<p ><a class="anchor" id="autotoc_md456"></a> </p><h5><a class="el" href="classBehaviour.html" title="Class to derrive behaviours from, centralizing common variables such as from and until times.">Behaviour</a> settings flags</h5>
<p ><img src="../diagrams/behaviour_settings_flags.png" alt="Behaviour settings flags" class="inline"/></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Length in bits   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bool   </td><td class="markdownTableBodyNone">Enabled   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Whether behaviours are enabled.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">Reserved   </td><td class="markdownTableBodyNone">31   </td><td class="markdownTableBodyNone">Reserved for future use, should be 0 for now.   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
